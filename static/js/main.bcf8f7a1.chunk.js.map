{"version":3,"sources":["images/logo.png","images/darkLogo.png","images/graphic.png","util/FileIdAndTypeUtils.js","util/FetchWithTimeout.js","reducers/BackendModeSignedInStatus.js","components/LandingPage.js","util/ConvertStrValueOrDefault.js","reducers/CurrentOpenFileState.js","reducers/SetTagsInView.js","store.js","editor_extension/plugins/SelectNode.js","editor_extension/plugins/TagFiltering.js","editor_extension/plugins/CancelLineBreaks.js","editor_extension/BlockTagging.js","components/TagMenu.js","backend/LocalFileStorageSystemClient.js","backend/HostedFileStorageSystemClient.js","backend/FileStorageSystemClient.js","components/Editor.js","components/SourceEditorWithTagFiltersInput.js","components/Navigator.js","lib/TagFiltersGrammar.js","components/Navbar.js","components/CardView/Card.js","components/ViewComponents/DragDropColumn.js","components/ViewComponents/TagEditor.js","components/CardView/CardDeck.js","components/TextView/TextView.js","components/ViewEditor.js","components/EditorManager.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","FILE_TYPE","SOURCE","TEXT_VIEW","CARD_VIEW","EMPTY","NO_OPEN_FILE_ID","sourceId","viewId","viewType","validateFileIdObj","fileId","hasOwnProperty","validateHasFileIdObj","state","validateHasFileNameObj","fileName","checkNoOpenFileId","checkSourceFileId","checkViewFileId","getFileIdKeyStr","fetchWithTimeout","uri","options","a","time","controller","AbortController","setTimeout","abort","fetch","signal","then","response","ok","console","log","SERVER_BASE_URL","BACKEND_MODE_SIGNED_IN_STATUS","USER_SIGNED_IN","USER_SIGNED_OUT","LOCAL_STORAGE","getUserSignedInStatus","token","Cookies","get","headers","Headers","setBackendModeSignedInStatusAction","status","type","CLIENT_ID","LandingPage","handleLoginSuccess","profileObj","name","email","tokenObj","id_token","expiry","expiresAt","axios","post","method","body","JSON","stringify","withCredentials","set","expires","Date","props","dispatchSetBackendModeSignedInStatusAction","render","style","display","flexFlow","height","overflow","className","flexGrow","AppBar","position","class","Toolbar","src","require","width","marginRight","backgroundColor","flex","Grid","container","spacing","alignItems","item","xs","marginLeft","Typography","variant","fontFamily","color","text","speed","clientId","buttonText","onSuccess","onFailure","cookiePolicy","responseType","float","Button","onClick","React","Component","connect","backendModeSignedInStatus","dispatch","mode","convertStrValueOrDefault","valueStr","defaultValue","failureMessage","convertFromString","parse","value","e","convertStrValueOrDefaultIfFalsy","storedInitialFileId","localStorage","getItem","storedInitialFileName","initialFileId","initialFileName","sourceName","viewName","setCurrentOpenFileIdAction","setCurrentOpenFileNameAction","setSelectNodeAction","selectNode","setTagsInViewAction","tagsInView","configureStore","reducer","combineReducers","currentOpenFileId","action","currentOpenFileName","saveDirtyFlag","setItem","removeItem","SelectNodePluginKey","PluginKey","Plugin","key","init","apply","tr","_value","oldState","head","selection","newState","doc","nodesBetween","node","pos","attrs","eq","store","decorations","selectDecorations","getState","push","Decoration","nodeSize","DecorationSet","create","TagFilteringPluginKey","evaluateTagFilters","tagFilters","parentTags","match","taggable","nodeTags","matchTagFilters","tags","Array","isArray","length","match1","isTextblock","cumulativeChildSize","i","childCount","child","childMatch","v","val","getMeta","undefined","filterDecorations","CancelLineBreaksPluginKey","filterTransaction","steps","every","step","toJSON","stepType","slice","content","some","isLeaf","checkInsertLineBreakReplaceStep","from","to","fromNode","nodeAt","toNode","checkRemoveLineBreakReplaceStep","CancelLineBreaksPlugin","SelectNodePlugin","TagFilteringPlugin","Extension","TAG_VALUE_REGEX","INVALID_TAG_VALUE_REGEX","TagMenu","selectNodeAttrs","modifying","handleAddTag","tag","document","getElementById","trim","test","alert","newSelectNodeAttrs","uuidv4","BlockTaggingEditorExtension","editor","view","setNodeMarkup","setState","dispatchSetSaveDirtyFlagAction","handleDeleteTag","handleModifyTagValue","oldTagValue","newTagValue","handleCancelModifyTagValue","input","setSelectionRange","handleStartModifyingTagValue","defer","focus","componentDidUpdate","prevProps","id","title","placeholder","disabled","onKeyPress","event","target","preventDefault","onKeyDown","Object","keys","map","onBlur","blur","hidden","doSetLocalStorageSourceViews","sourceViews","doGetLocalStorageSourceViews","doSetLocalStorageSourceIdNames","sourceIdNames","calculateLocalStorageNextNewId","existingIdsDict","candidate","toString","calculateLocalStorageNextNewFileIds","filesList","source","nextNewViewIdsForSourceIds","fromEntries","entries","views","doGetFilesList","doSaveViewSpec","tagsList","createNew","viewSpecLocalStorageKey","doGetView","doGetSourceTaggedBlocks","sourceContentDocStr","sourceContentDoc","sourceTaggedBlocks","nodes","shift","tagId","doSaveSourceContent","saveValue","sourceContentLocalStorageKey","doGetSourceContent","doSetSourceSavedTagFilters","sourceSavedTagFilters","sourceSavedTagFiltersLocalStorageKey","doGetSourceSavedTagFilters","doDeleteView","doDeleteSource","localStorageSourceViewIds","doRenameView","doRenameSource","EMPTY_SOURCE_CONTENT","json","viewID","viewResponse","tagResponse","view_json","tags_json","filters","getFileStorageSystemClient","LocalFileStorageSystemClient","HostedFileStorageSystemClient","clientInterface","Error","reduce","partial","fileStorageSystemClient","handleSaveCurrentFileEditorContent","FileStorageSystemClient","success","Editor","noOpenFileIdCheck","extensions","fileIdKeyStr","fileContent","jsonStrValue","setSelection","TextSelection","onChange","DEFAULT_STATE","SourceEditorWithTagFiltersInput","changeFile","focusAtStart","handleSetCurrentOpenFileId","componentDidMount","window","confirm","batch","convertFilesListStateToFileIdNamesList","filesListState","countNumFiles","count","RENAME_INPUT_TYPES","getRenameInputIdFunctions","NO_RENAMING_STATE","inputType","searching","renaming","nextNewFileIds","selectedFileId","selectedViewId","selectedFileOpen","editMenuAnchorElement","renameSelected","newViewAnchorElement","FileListItem","selected","padding","IconButton","InputBase","Divider","orientation","handleEditMenuClick","fontSize","border","childViewsExist","open","Navigator","resetState","getSourceName","getViewName","getFileName","getRenameInputValueFunctions","handleSwitchBackendModeSignedInStatus","handleCancelRenaming","handleClearSearchingInput","handleChangeSearchingInput","handleDoFileNamesSearch","filter","includes","handleCreateNewFile","fileType","sourceFileType","localStorageNextNewFileId","newFilePromise","newFile","updatedSourceId","newFilesList","parseInt","handleDeleteFile","sourceFileIdCheck","deleteFilePromise","newSourceViews","newNextNewViewIdsForSourceIds","handleRenameFile","newName","renameFilePromise","prevState","filesListValue","renameInput","remainingProps","inputId","handleFileListClick","handleViewListClick","currentTarget","handleEditMenuClose","handleDeleteMenuClick","handleRenameMenuClick","renamePopoverElement","handleRenamePopoverClose","handleViewMenuOpen","handleViewMenuClose","numFiles","filteredFilesList","numFilteredFiles","endIcon","disableElevation","Input","startAdornment","InputAdornment","debounce","List","component","aria-labelledby","subheader","ListSubheader","ListItem","button","disableGutters","divider","Collapse","in","timeout","unmountOnExit","disablePadding","Menu","anchorEl","keepMounted","Boolean","onClose","anchorOrigin","vertical","horizontal","transformOrigin","MenuItem","ListItemIcon","ListItemText","primary","Popover","endAdornment","disableUnderline","fullWidth","remove","x","Grammar","Lexer","ParserRules","symbols","postprocess","literal","d","join","concat","ParserStart","inputText","outputParsedExpr","parser","nearley","Parser","fromCompiled","feed","results","ex","modifyingTagFilters","currentTagFiltersStr","currentParsedTagFiltersStr","Navbar","handleCancelModifyingTagFilters","handleStartModifyingTagFilters","handleUnpersistCurrentTagFilters","newSourceSavedTagFilters","handlePersistNewSavedTagFilters","handleApplyTagFilters","tagFiltersStr","parseTagFilters","parsedTagFiltersStr","oldParsedTagFiltersStr","setMeta","Selection","atStart","scrollIntoView","dom","forEach","element","currentTagFiltersSaved","Breadcrumbs","aria-label","borderRadius","Link","startIcon","paddingTop","paddingBottom","marginTop","Autocomplete","freeSolo","renderInput","params","TextField","margin","reason","paddingRight","edge","aria-haspopup","Card","front","back","isFlipped","flipDirection","createBootstrapCard","handleClick","bind","this","readOnly","Tag","Container","styled","div","isDragging","TagId","h5","Content","draggableId","index","provided","snapshot","ref","innerRef","draggableProps","dragHandleProps","tagInfo","preview","InnerTagList","nextProps","nextState","nextContext","tagData","DragDropColumn","isDraggingOver","Title","h3","DroppableRegion","TagList","droppableId","column","droppableProps","tagListRef","createRef","list","current","scrollHeight","scrollTop","TagEditor","onDragEnd","result","destination","columns","newTagIds","tagIds","splice","newColumn","start","finish","startTagIds","newStart","finishTagIds","newFinish","setTagsInView","tags_in_view","Row","columnOrder","columnId","tagDataInColumn","Col","md","lg","Set","availableTags","allTagsData","t","has","getPreview","contentNode","recurseResponse","substring","tags_available","assign","CardDeck","keydownHandler","navigator","platform","metaKey","ctrlKey","keyCode","catch","constructDoc","constructCard","cardContent","addEventListener","componentWillUnmount","removeEventListener","cards","xl","data","TextView","constructTextView","ViewEditor","EditorManager","theme","createMuiTheme","palette","main","secondary","App","mounted","Fragment","location","hostname","StrictMode","rel","href","serviceWorker","ready","registration","unregister","error","message"],"mappings":"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","file":"static/js/main.bcf8f7a1.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.e9d28ab1.png\";","module.exports = __webpack_public_path__ + \"static/media/darkLogo.eccc7628.png\";","module.exports = __webpack_public_path__ + \"static/media/graphic.2ab501e2.png\";","export const FILE_TYPE = {\n  SOURCE: 'SOURCE',\n  TEXT_VIEW: 'TEXT_VIEW',\n  CARD_VIEW: 'CARD_VIEW',\n  EMPTY: 'NON_EXISTENT',\n};\n\nexport const NO_OPEN_FILE_ID = { sourceId: 0, viewId: 0, viewType: FILE_TYPE.EMPTY };\n\nexport const validateFileIdObj = fileId => fileId.hasOwnProperty('sourceId') && fileId.hasOwnProperty('viewId');\nexport const validateHasFileIdObj = state => state.hasOwnProperty('fileId') && validateFileIdObj(state.fileId);\nexport const validateFileNameObj = fileName => fileName.hasOwnProperty('sourceName') && fileName.hasOwnProperty('viewName');\nexport const validateHasFileNameObj = state => state.hasOwnProperty('fileName') && validateFileNameObj(state.fileName);\n\nexport const checkNoOpenFileId = fileId => validateFileIdObj(fileId) && !fileId.sourceId && !fileId.viewId;\nexport const checkSourceFileId = fileId => validateFileIdObj(fileId) && fileId.sourceId && !fileId.viewId;\nexport const checkViewFileId = fileId => validateFileIdObj(fileId) && fileId.sourceId && fileId.viewId;\n\nexport const getFileIdKeyStr = fileId => validateFileIdObj(fileId)\n  ? (fileId.sourceId + (fileId.viewId ? '#' + fileId.viewId : '')) : '';\n","export const fetchWithTimeout = async (uri, options, time = 7500) => {\n  const controller = new AbortController();\n  setTimeout(() => { controller.abort(); }, time);\n  return await fetch(uri, { ...options, signal: controller.signal }).then((response) => {\n    if (!response.ok) { console.log(response); }\n    return response\n  });\n};\n","import Cookies from 'js-cookie';\nimport {fetchWithTimeout} from '../util/FetchWithTimeout';\n\nexport const SERVER_BASE_URL = process.env.NODE_ENV === 'development'\n  ? \"http://localhost:5000/\" : \"https://yaas-gca4j5hw3q-uc.a.run.app/\";\n\nexport const BACKEND_MODE_SIGNED_IN_STATUS = {\n  USER_SIGNED_IN: 'USER_SIGNED_IN',\n  USER_SIGNED_OUT: 'USER_SIGNED_OUT',\n  LOCAL_STORAGE: 'LOCAL_STORAGE',\n}\n\nexport const ACCESS_TOKEN_COOKIE_KEY = 'access_token';\n\nexport const getUserSignedInStatus = async () => {\n  const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n  if (token) {\n    try {\n      const { ok } = await fetchWithTimeout(\n        SERVER_BASE_URL + `auth`,\n        { headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      if (ok) { return BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_IN; }\n    } catch (e) { console.log(e); }\n  }\n  return BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_OUT;\n};\n\nexport const INITIAL_LOCAL_STORAGE_BACKEND_MODE_LOCAL_STORAGE_KEY = 'initialLocalStorageBackendMode';\n\nconst SET_BACKEND_MODE_SIGNED_IN_STATUS_ACTION_TYPE = 'backendModeSignedInStatus/set';\nexport const setBackendModeSignedInStatusAction =\n  status => ({ type: SET_BACKEND_MODE_SIGNED_IN_STATUS_ACTION_TYPE, status });\nexport const backendModeSignedInStatusReducer = (\n  state = localStorage.getItem(INITIAL_LOCAL_STORAGE_BACKEND_MODE_LOCAL_STORAGE_KEY)\n    ? BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE : BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_OUT,\n  action,\n) => {\n  if (\n    action.type !== SET_BACKEND_MODE_SIGNED_IN_STATUS_ACTION_TYPE || !action.hasOwnProperty('status') ||\n    !BACKEND_MODE_SIGNED_IN_STATUS.hasOwnProperty(action.status)\n  ) { return state; }\n  if (action.status === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE) {\n    localStorage.setItem(INITIAL_LOCAL_STORAGE_BACKEND_MODE_LOCAL_STORAGE_KEY, true);\n  } else { localStorage.removeItem(INITIAL_LOCAL_STORAGE_BACKEND_MODE_LOCAL_STORAGE_KEY); }\n  return action.status;\n};\n","import React from 'react';\nimport {connect} from 'react-redux';\nimport {GoogleLogin} from 'react-google-login';\nimport axios from 'axios';\nimport Cookies from 'js-cookie'\nimport {\n  BACKEND_MODE_SIGNED_IN_STATUS,\n  SERVER_BASE_URL,\n  ACCESS_TOKEN_COOKIE_KEY,\n  setBackendModeSignedInStatusAction,\n} from '../reducers/BackendModeSignedInStatus';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport Button from '@material-ui/core/Button';\nimport ReactTypingEffect from 'react-typing-effect';\n\nconst CLIENT_ID = '709358329925-gic89ini15sgaenfrta1gshej1ik72jg.apps.googleusercontent.com';\n\nclass LandingPage extends React.Component {\n\n  handleLoginSuccess = async ({ profileObj: { name, email }, tokenObj: { id_token: token, expiresAt: expiry } }) => {\n    let response = null;\n    try {\n      response = await axios.post(\n        SERVER_BASE_URL + 'register_user',\n        {\n          method: 'POST',\n          body: JSON.stringify({ name, email, token }),\n          headers: { 'Content-Type': 'application/json', 'Set-Cookie': `token=${token}` },\n        },\n        { withCredentials: true },\n      );\n    } catch(e) { console.log(e); }\n    if (response && response.status === 201) {\n      Cookies.set(ACCESS_TOKEN_COOKIE_KEY, token, { expires: new Date(expiry) });\n      this.props.dispatchSetBackendModeSignedInStatusAction(BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_IN);\n    }\n  };\n\n  render = () =>\n    <div style={{display:\"flex\", flexFlow: \"column\", height: \"100vh\", overflow: \"hidden\"}}>\n      <div className={\"landing-root\"} style={{flexGrow: \"0 1 auto\"}}>\n      <AppBar position=\"static\" class=\"custom-navbar\">\n        <Toolbar>\n          <img className={\"menuButton\"} src={require('../images/logo.png')} style={{width: \"50px\", marginRight: \"1%\"}}/>\n        </Toolbar>\n      </AppBar>\n\n    </div>\n    <div style={{backgroundColor: \"#F5F0E1\", flex: \"1 1 auto\"}}>\n    <Grid container spacing={3} alignItems=\"center\" style={{height: \"100%\"}}>\n        <Grid item xs={1}></Grid>\n        <Grid item xs={5} alignItems=\"center\">\n          <Grid container spacing={3} alignItems=\"center\">\n            <Grid item xs={3}>\n              <img src={require('../images/darkLogo.png')} style={{width: \"90%\", marginLeft: \"20%\"}}/>\n            </Grid>\n            <Grid item xs={9}>\n              <Typography variant=\"h1\" className={\"title\"} style={{fontFamily:\"Bungee\", color:\"#1E3D59\"}}>\n              YADA\n              <ReactTypingEffect\n                text = \"\"\n                style={{fontFamily:\"Signika\"}}\n                speed = {10000}\n              />\n              </Typography>\n              <Typography variant=\"h3\" className={\"title\"} style={{fontFamily:\"Signika\", color:\"#1E3D59\"}}>\n               Yet Another Docs App\n              </Typography>\n             </Grid>\n          </Grid>\n          <br />\n          <div style={{marginLeft: \"8%\"}}>\n              <GoogleLogin\n                  clientId={CLIENT_ID}\n                  buttonText=\"Sign in With Google\"\n                  onSuccess={response => { this.handleLoginSuccess(response); }}\n                  onFailure={response => { console.log(response); }}\n                  cookiePolicy=\"single_host_origin\"\n                  responseType=\"code,token\"\n                  style={{float: \"left\"}}\n                />\n                <Button \n                  variant=\"outlined\"\n                  style={{\"height\" : \"250%\", marginLeft: \"3%\"}}\n                  onClick={() => {\n                    this.props.dispatchSetBackendModeSignedInStatusAction(BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE);\n                  }}>\n                  Use local storage\n                </Button>\n          </div>\n        </Grid>\n        <Grid item xs={6}>\n           <img src={require('../images/graphic.png')} style={{width: \"70%\", marginLeft: \"10%\"}}/>\n        </Grid>\n    </Grid>\n    </div>\n  </div>\n}\n\nexport default connect(\n  state => ({ backendModeSignedInStatus: state.backendModeSignedInStatus }),\n  dispatch => ({\n    dispatchSetBackendModeSignedInStatusAction: mode => dispatch(setBackendModeSignedInStatusAction(mode)),\n  }),\n)(LandingPage);\n","export const convertStrValueOrDefault =\n  (valueStr, defaultValue, failureMessage, convertFromString = valueStr => JSON.parse(valueStr)) => {\n    let value = defaultValue;\n    if (valueStr) {\n      try { value = convertFromString(valueStr); }\n      catch (e) {\n        if (failureMessage) { console.log(failureMessage); }\n        console.log(e);\n      }\n    }\n    return value;\n  };\n\nexport const convertStrValueOrDefaultIfFalsy =\n  (valueStr, defaultValue, failureMessage, convertFromString = valueStr => JSON.parse(valueStr)) => {\n    if (!valueStr) { return defaultValue; }\n    let value = null;\n    try { value = convertFromString(valueStr); }\n    catch (e) {\n      if (failureMessage) { console.log(failureMessage); }\n      console.log(e);\n    }\n    return value;\n  };\n","import {convertStrValueOrDefault} from '../util/ConvertStrValueOrDefault';\nimport {NO_OPEN_FILE_ID, validateHasFileIdObj, validateHasFileNameObj} from '../util/FileIdAndTypeUtils';\n\nexport const INITIAL_FILE_ID_LOCAL_STORAGE_KEY = 'initialFileId';\nexport const INITIAL_FILE_NAME_LOCAL_STORAGE_KEY = 'initialFileName';\n\nconst storedInitialFileId = convertStrValueOrDefault(\n  localStorage.getItem(INITIAL_FILE_ID_LOCAL_STORAGE_KEY),\n  {},\n  'invalid initialFileId',\n);\n\nconst storedInitialFileName = convertStrValueOrDefault(\n  localStorage.getItem(INITIAL_FILE_NAME_LOCAL_STORAGE_KEY),\n  {},\n  'invalid initialFileName',\n);\n\nconst initialFileId = {\n  sourceId: storedInitialFileId.hasOwnProperty('sourceId')\n    ? storedInitialFileId.sourceId : NO_OPEN_FILE_ID.sourceId,\n  viewId: storedInitialFileId.hasOwnProperty('viewId') ? storedInitialFileId.viewId : NO_OPEN_FILE_ID.viewId,\n  viewType: storedInitialFileId.hasOwnProperty('viewType') ? storedInitialFileId.viewType : NO_OPEN_FILE_ID.viewId,\n}\n\nconst initialFileName = {\n  sourceName: storedInitialFileName.hasOwnProperty('sourceName')\n    ? storedInitialFileName.sourceName : '',\n  viewName: storedInitialFileName.hasOwnProperty('viewName') ? storedInitialFileName.viewName : '',\n}\n\nconst SET_CURRENT_OPEN_FILE_ID_ACTION_TYPE = 'currentOpenFileId/set';\nexport const setCurrentOpenFileIdAction = fileId => ({ type: SET_CURRENT_OPEN_FILE_ID_ACTION_TYPE, fileId });\nexport const currentOpenFileIdReducer = (state = initialFileId, action) =>\n  action.type !== SET_CURRENT_OPEN_FILE_ID_ACTION_TYPE || !validateHasFileIdObj(action)\n    ? state : action.fileId;\n\nconst SET_CURRENT_OPEN_FILE_NAME_ACTION_TYPE = 'currentOpenFileName/set';\nexport const setCurrentOpenFileNameAction = fileName => ({ type: SET_CURRENT_OPEN_FILE_NAME_ACTION_TYPE, fileName });\nexport const currentOpenFileNameReducer = (state = initialFileName, action) =>\n  action.type !== SET_CURRENT_OPEN_FILE_NAME_ACTION_TYPE || !validateHasFileNameObj(action)\n    ? state : action.fileName;\n\nexport const SET_SAVE_DIRTY_FLAG_ACTION_TYPE = 'saveDirtyFlag/set';\nexport const CLEAR_SAVE_DIRTY_FLAG_ACTION_TYPE = 'saveDirtyFlag/clear';\nexport const saveDirtyFlagReducer = (state = false, action) =>\n  action.type !== SET_SAVE_DIRTY_FLAG_ACTION_TYPE && action.type !== CLEAR_SAVE_DIRTY_FLAG_ACTION_TYPE\n    ? state : action.type === SET_SAVE_DIRTY_FLAG_ACTION_TYPE;\n\nconst SET_SELECT_NODE_ACTION_TYPE = 'selectNode/set';\nexport const setSelectNodeAction = selectNode => ({ type: SET_SELECT_NODE_ACTION_TYPE, selectNode });\nexport const selectNodeReducer = (state = null, action) =>\n  action.type === SET_SELECT_NODE_ACTION_TYPE && action.hasOwnProperty('selectNode') &&\n  (!action.selectNode || action.selectNode.hasOwnProperty('pos'))\n    ? action.selectNode : (action.type === SET_SELECT_NODE_ACTION_TYPE ? null : state);\n","export const SET_TAGS_IN_VIEW_ACTION_TYPE = 'tagsInView/set';\nexport const setTagsInViewAction = tagsInView => ({ type: SET_TAGS_IN_VIEW_ACTION_TYPE, tagsInView });\nexport const setTagsInViewReducer = (state = null, action) =>\n\taction.type !== SET_TAGS_IN_VIEW_ACTION_TYPE || !action.hasOwnProperty('tagsInView')\n\t\t? state : action.tagsInView;\n","import {configureStore} from '@reduxjs/toolkit';\nimport {combineReducers} from 'redux';\nimport {currentOpenFileIdReducer, saveDirtyFlagReducer, selectNodeReducer, currentOpenFileNameReducer} from './reducers/CurrentOpenFileState';\nimport {backendModeSignedInStatusReducer} from './reducers/BackendModeSignedInStatus';\nimport {setTagsInViewReducer} from \"./reducers/SetTagsInView\";\n\nexport default configureStore({\n  reducer: combineReducers({\n    currentOpenFileId: currentOpenFileIdReducer,\n    currentOpenFileName: currentOpenFileNameReducer,\n    saveDirtyFlag: saveDirtyFlagReducer,\n    selectNode: selectNodeReducer,\n    backendModeSignedInStatus: backendModeSignedInStatusReducer,\n    tagsInView: setTagsInViewReducer\n  }),\n});\n","import {Plugin, PluginKey} from 'prosemirror-state';\nimport {Decoration, DecorationSet} from 'prosemirror-view';\nimport {setSelectNodeAction} from '../../reducers/CurrentOpenFileState';\nimport store from '../../store';\n\nconst SELECT_NODE_PLUGIN_NAME = 'select-node';\nexport const SelectNodePluginKey = new PluginKey(SELECT_NODE_PLUGIN_NAME);\n\nexport default new Plugin({\n  key: SelectNodePluginKey,\n  state: {\n    init: () => null,\n    apply: (tr, _value, oldState) => {\n      let head = tr.selection.head;\n      let newState = null;\n      tr.doc.nodesBetween(head, head, (node, pos) => {\n        if (node.hasOwnProperty('attrs') && node.attrs['tags']) { newState = { node, pos }; }\n      });\n      if (\n        (!oldState && newState) || (oldState && !newState) ||\n        (oldState && newState && (newState.pos !== oldState.pos || !newState.node.eq(oldState.node)))\n      ) { store.dispatch(setSelectNodeAction(newState ? { pos: newState.pos } : null)); }\n      return newState;\n    },\n  },\n  props: {\n    decorations: state => {\n      const selectDecorations = [];\n      const selectNode = SelectNodePluginKey.getState(state);\n      if (selectNode) {\n        selectDecorations.push(Decoration.node(\n          selectNode.pos,\n          selectNode.pos + selectNode.node.nodeSize,\n          { style: 'background: #FAFAFA; outline: 1px solid #DCDCDC;' },\n        ));\n      }\n      return DecorationSet.create(state.doc, selectDecorations);\n    },\n  },\n});\n","import {Plugin, PluginKey} from 'prosemirror-state';\nimport {Decoration, DecorationSet} from 'prosemirror-view';\nimport {SelectNodePluginKey} from './SelectNode';\n\nconst TAG_FILTERING_PLUGIN_NAME = 'tag-filtering';\nexport const TagFilteringPluginKey = new PluginKey(TAG_FILTERING_PLUGIN_NAME);\n\nconst matchTagFilters = (tags, tagFilters) => {\n  if (!tagFilters) { return true; }\n  if (!Array.isArray(tagFilters)) { return tags.hasOwnProperty(tagFilters); }\n  // invariant: tagFilters isArray\n  // only not expressions have array length 2\n  if (tagFilters.length === 2) { return !matchTagFilters(tags, tagFilters[1]); }\n  const match1 = matchTagFilters(tags, tagFilters[0]);\n  if (tagFilters.length === 1) { return match1; }\n  // invariant: length 3, [1] is op, [2] is tag or sub expression\n  const andOp = tagFilters[1] === '&';\n  // short circuit evaluation\n  if (andOp !== match1) { return match1; }\n  // invariant:\n  // if andOp then !match1, so result should be match2,\n  // if !andOp then match1, so result should be match2\n  return matchTagFilters(tags, tagFilters[2]);\n};\n\nconst evaluateTagFilters = (decorations, tagFilters, selectNode, node, parentTags, pos) => {\n  let match = false;\n  const taggable = node.hasOwnProperty('attrs') && node.attrs['tags'];\n  const nodeTags = { ...parentTags, ...(taggable ? node.attrs['tags'] : null) };\n  if (taggable) { match = matchTagFilters(nodeTags, tagFilters); }\n  if (!node.isTextblock) {\n    let cumulativeChildSize = 1;\n    for (let i = 0; i < node.childCount; ++i) {\n      const child = node.child(i);\n      const childPos = pos + cumulativeChildSize;\n      const childMatch = evaluateTagFilters(decorations, tagFilters, selectNode, child, nodeTags, childPos);\n      match = match || childMatch;\n      cumulativeChildSize += child.nodeSize;\n    }\n  }\n  if (pos !== 0 && !match) {\n    decorations.push(Decoration.node(pos - 1, pos - 1 + node.nodeSize, { style: 'display: none;' }));\n  }\n  return match;\n};\n\nexport default new Plugin({\n  key: TagFilteringPluginKey,\n  state: {\n    init: () => null,\n    apply: (tr, v) => {\n      const val = tr.getMeta(TagFilteringPluginKey);\n      return val === undefined ? v : val;\n    },\n  },\n  props: {\n    decorations: state => {\n      const filterDecorations = [];\n      const tagFilters = TagFilteringPluginKey.getState(state);\n      const selectNode = SelectNodePluginKey.getState(state);\n      if (tagFilters) { evaluateTagFilters(filterDecorations, tagFilters, selectNode, state.doc, {}, 0); }\n      return DecorationSet.create(state.doc, filterDecorations);\n    },\n  },\n});\n","import {Plugin, PluginKey} from 'prosemirror-state';\nimport {checkSourceFileId} from '../../util/FileIdAndTypeUtils';\nimport {TagFilteringPluginKey} from './TagFiltering';\nimport store from '../../store';\n\nconst CANCEL_LINE_BREAKS_PLUGIN_NAME = 'cancel-line-breaks';\nexport const CancelLineBreaksPluginKey = new PluginKey(CANCEL_LINE_BREAKS_PLUGIN_NAME);\n\nconst checkInsertLineBreakReplaceStep = step => step.slice.content.content.some(node => !node.isLeaf);\n\nconst checkRemoveLineBreakReplaceStep = (step, doc) => {\n  if (step.from === step.to) { return false; }\n  const fromNode = doc.nodeAt(step.from);\n  const toNode = doc.nodeAt(step.to);\n  if (toNode) { return !fromNode || (fromNode && !fromNode.eq(toNode)); }\n  return !fromNode || !doc.nodeAt(step.to - 1).eq(fromNode);\n};\n\nexport default new Plugin({\n  key: CancelLineBreaksPluginKey,\n  filterTransaction: (tr, state) =>\n    (checkSourceFileId(store.getState().currentOpenFileId) && !TagFilteringPluginKey.getState(state)) ||\n    tr.steps.every(\n      step => step.toJSON().stepType !== 'replace' ||\n        (!checkInsertLineBreakReplaceStep(step) && !checkRemoveLineBreakReplaceStep(step, state.doc))\n    ),\n});\n","import {Extension} from 'rich-markdown-editor';\nimport CancelLineBreaksPlugin from './plugins/CancelLineBreaks';\nimport SelectNodePlugin from './plugins/SelectNode';\nimport TagFilteringPlugin from './plugins/TagFiltering';\n\nclass BlockTagging extends Extension {\n  get name() { return 'yada-blockTagging'; }\n  get plugins() { return [CancelLineBreaksPlugin, SelectNodePlugin, TagFilteringPlugin]; }\n}\n\nexport default new BlockTagging();\n","import './TagMenu.css';\nimport {defer} from 'lodash';\nimport {v4 as uuidv4} from 'uuid';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {SET_SAVE_DIRTY_FLAG_ACTION_TYPE} from '../reducers/CurrentOpenFileState';\n\nimport BlockTaggingEditorExtension from '../editor_extension/BlockTagging';\n\nconst BLOCK_NODE_TAGS_LIST_ID = 'block_node_tags_list';\n\nconst ADD_TAG_INPUT_ID = 'add_tag_input';\n\nconst MODIFY_TAG_INPUT_ID_PREFIX = 'modify_tag_input_';\n\nconst TAG_VALUE_REGEX = /[^{}]/;\nconst INVALID_TAG_VALUE_REGEX = /[{}]/;\n\nclass TagMenu extends React.Component {\n\n  state = { selectNodeAttrs: {}, modifying: '' }\n\n  handleAddTag = () => {\n    const tag = document.getElementById(ADD_TAG_INPUT_ID).value.trim();\n    if (!tag || INVALID_TAG_VALUE_REGEX.test(tag) || !this.props.selectNode) { return false; }\n    if (this.state.selectNodeAttrs.hasOwnProperty('tags') && this.state.selectNodeAttrs.tags.hasOwnProperty(tag)) {\n      alert('tag value \"' + tag + '\" already exists');\n      return false;\n    }\n    const newSelectNodeAttrs = { ...this.state.selectNodeAttrs, tags: {...this.state.selectNodeAttrs.tags} };\n    newSelectNodeAttrs.tags[tag] = uuidv4();\n    BlockTaggingEditorExtension.editor.view.dispatch(\n      BlockTaggingEditorExtension.editor.view.state.tr.setNodeMarkup(\n        this.props.selectNode.pos,\n        null,\n        newSelectNodeAttrs,\n      )\n    );\n    this.setState({ selectNodeAttrs: newSelectNodeAttrs });\n    this.props.dispatchSetSaveDirtyFlagAction();\n    return true;\n  };\n\n  handleDeleteTag = tag => {\n    if (\n      !this.props.selectNode || !this.state.selectNodeAttrs.hasOwnProperty('tags') ||\n      !this.state.selectNodeAttrs.tags.hasOwnProperty(tag)\n    ) { return false; }\n    const newSelectNodeAttrs = { ...this.state.selectNodeAttrs, tags: {...this.state.selectNodeAttrs.tags} };\n    delete newSelectNodeAttrs.tags[tag];\n    BlockTaggingEditorExtension.editor.view.dispatch(\n      BlockTaggingEditorExtension.editor.view.state.tr.setNodeMarkup(\n        this.props.selectNode.pos,\n        null,\n        newSelectNodeAttrs,\n      )\n    );\n    this.setState({ selectNodeAttrs: newSelectNodeAttrs });\n    this.props.dispatchSetSaveDirtyFlagAction();\n    return true;\n  };\n\n  handleModifyTagValue = oldTagValue => {\n    const newTagValue = document.getElementById(MODIFY_TAG_INPUT_ID_PREFIX + oldTagValue).value.trim();\n    if (\n      !newTagValue || INVALID_TAG_VALUE_REGEX.test(newTagValue) || !this.props.selectNode ||\n      !this.state.selectNodeAttrs.hasOwnProperty('tags') ||\n      !this.state.selectNodeAttrs.tags.hasOwnProperty(oldTagValue)\n    ) { return false; }\n    if (newTagValue === oldTagValue) { return true; }\n    if (this.state.selectNodeAttrs.tags.hasOwnProperty(newTagValue)) {\n      alert('tag value \"' + newTagValue + '\" already exists');\n      return false;\n    }\n    const newSelectNodeAttrs = { ...this.state.selectNodeAttrs, tags: {...this.state.selectNodeAttrs.tags} };\n    newSelectNodeAttrs.tags[newTagValue] = newSelectNodeAttrs.tags[oldTagValue];\n    delete newSelectNodeAttrs.tags[oldTagValue];\n    BlockTaggingEditorExtension.editor.view.dispatch(\n      BlockTaggingEditorExtension.editor.view.state.tr.setNodeMarkup(\n        this.props.selectNode.pos,\n        null,\n        newSelectNodeAttrs,\n      )\n    );\n    this.setState({ selectNodeAttrs: newSelectNodeAttrs });\n    this.props.dispatchSetSaveDirtyFlagAction();\n    return true;\n  };\n\n  handleCancelModifyTagValue = tag => {\n    const input = MODIFY_TAG_INPUT_ID_PREFIX + tag;\n    input.value = tag;\n    input.setSelectionRange(0, 0);\n    if (this.state.modifying === tag) { this.setState({ modifying: '' }); }\n  };\n\n  handleStartModifyingTagValue = (tag) => {\n    this.setState({ modifying: tag });\n    defer(() => {\n      const input = document.getElementById(MODIFY_TAG_INPUT_ID_PREFIX + tag);\n      input.focus();\n      input.setSelectionRange(0, input.value.length);\n    });\n  };\n  \n  componentDidUpdate = prevProps => {\n    if (\n      prevProps.currentOpenFileId.sourceId !== this.props.currentOpenFileId.sourceId ||\n      prevProps.currentOpenFileId.viewId !== this.props.currentOpenFileId.viewId ||\n      (!prevProps.selectNode && this.props.selectNode) || (prevProps.selectNode && !this.props.selectNode) ||\n      (prevProps.selectNode && this.props.selectNode && prevProps.selectNode.pos !== this.props.selectNode.pos)\n    ) {\n      document.getElementById(ADD_TAG_INPUT_ID).value = '';\n      defer(() => {\n        if (this.props.selectNode) {\n          const node = BlockTaggingEditorExtension.editor.view.state.doc.nodeAt(this.props.selectNode.pos);\n          this.setState({ selectNodeAttrs: {...(node && node.hasOwnProperty('attrs') ? node.attrs : null)} });\n        } else { this.setState({ selectNodeAttrs: {} }); }\n      });\n    }\n  };\n\n  render = () =>\n    <div className=\"MarginPane\">\n      <div id=\"tag_menu_wrapper\">\n        <div className=\"InputRow\" id=\"add_tag_input_row\">\n          <input\n            id={ADD_TAG_INPUT_ID}\n            title=\"new tag\"\n            placeholder=\"new tag\"\n            disabled={!this.props.selectNode}\n            onKeyPress={event=> {\n              if (event.key === 'Enter' && this.handleAddTag()) { event.target.value = ''; }\n              if (!TAG_VALUE_REGEX.test(event.key)) { event.preventDefault(); }\n            }}\n            onKeyDown={event=> {\n              if (event.key === 'Escape') {\n                event.target.value = '';\n                BlockTaggingEditorExtension.editor.view.focus();\n              }\n            }}\n          />\n          <button\n            className=\"MonospaceCharButton\"\n            title=\"add\"\n            disabled={!this.props.selectNode}\n            onClick={this.handleAddTag}>\n            {'+'}\n          </button>\n        </div>\n        <div id=\"tag_menu_list_container\">\n          {\n            this.props.selectNode && this.state.selectNodeAttrs.hasOwnProperty('tags') &&\n            Object.keys(this.state.selectNodeAttrs.tags).length > 0\n              ? <ul id={BLOCK_NODE_TAGS_LIST_ID}>\n                  {\n                    Object.keys(this.state.selectNodeAttrs.tags).map(tag =>\n                      <li key={tag}>\n                        <div className=\"ButtonRow\">\n                          {\n                            this.state.modifying !== tag\n                              ? <button disabled>{tag}</button>\n                              :  <input\n                                  id={MODIFY_TAG_INPUT_ID_PREFIX + tag}\n                                  defaultValue={tag}\n                                  placeholder={tag}\n                                  disabled={this.state.modifying !== tag}\n                                  onBlur={event => {\n                                    this.handleModifyTagValue(tag);\n                                    if (this.state.modifying === tag) { this.setState({ modifying: '' }); }\n                                  }}\n                                  onKeyDown={event => {\n                                    if (event.key === 'Escape') { this.handleCancelModifyTagValue(tag); }\n                                  }}\n                                  onKeyPress={event => {\n                                    if (event.key === 'Enter') { event.target.blur(); }\n                                    if (!TAG_VALUE_REGEX.test(event.key)) { event.preventDefault(); }\n                                  }}\n                                />\n                          }\n                          <button\n                            className=\"MonospaceCharButton\"\n                            title=\"modify\"\n                            hidden={this.state.modifying === tag}\n                            onClick={() => { this.handleStartModifyingTagValue(tag); }}>\n                            {'#'}\n                          </button>\n                          <button\n                            className=\"MonospaceCharButton\"\n                            title=\"remove\"\n                            onClick={() => { this.handleDeleteTag(tag); }}>\n                            {'-'}\n                          </button>\n                        </div>\n                      </li>\n                    )\n                  }\n                </ul>\n              : <div className=\"PlaceholderDivWithText\" id=\"no_tags_placeholder\">\n                  {'no ' + (!this.props.selectNode ? 'selected block' : 'block tags')}\n                </div>\n          }\n        </div>\n      </div>\n    </div>;\n};\n\nexport default connect(\n  state => ({\n    selectNode: state.selectNode,\n    saveDirtyFlag: state.saveDirtyFlag,\n    currentOpenFileId: state.currentOpenFileId,\n  }),\n  dispatch => ({ dispatchSetSaveDirtyFlagAction: () => dispatch({ type: SET_SAVE_DIRTY_FLAG_ACTION_TYPE }) }),\n)(TagMenu);\n","import {convertStrValueOrDefault, convertStrValueOrDefaultIfFalsy} from '../util/ConvertStrValueOrDefault';\nimport {getFileIdKeyStr} from '../util/FileIdAndTypeUtils';\n\nconst SOURCE_VIEWS_LOCAL_STORAGE_KEY_PREFIX = 'sourceViews_';\n\n// API-ish\nexport const doSetLocalStorageSourceViews = (sourceId, sourceViews) =>\n  localStorage.setItem(SOURCE_VIEWS_LOCAL_STORAGE_KEY_PREFIX + sourceId, JSON.stringify(sourceViews));\n\nconst doGetLocalStorageSourceViews = sourceId => convertStrValueOrDefaultIfFalsy(\n  localStorage.getItem(SOURCE_VIEWS_LOCAL_STORAGE_KEY_PREFIX + sourceId),\n  {},\n  'invalid sourceViews',\n);\n\nconst SOURCE_ID_NAMES_LOCAL_STORAGE_KEY = 'sourceIdNames';\n\n// API-ish\nexport const doSetLocalStorageSourceIdNames = sourceIdNames =>\n  localStorage.setItem(SOURCE_ID_NAMES_LOCAL_STORAGE_KEY, JSON.stringify(sourceIdNames));\n\nconst doGetLocalStorageSourceIdNames = () => convertStrValueOrDefaultIfFalsy(\n  localStorage.getItem(SOURCE_ID_NAMES_LOCAL_STORAGE_KEY),\n  {},\n  'invalid sourceIdNames',\n);\n\nexport const calculateLocalStorageNextNewId = (existingIdsDict, candidate) => {\n  while (!candidate || existingIdsDict.hasOwnProperty(candidate.toString())) { candidate += 1; }\n  return candidate.toString();\n};\n\nexport const calculateLocalStorageNextNewFileIds = filesList => ({\n  source: calculateLocalStorageNextNewId(filesList, 0),\n  nextNewViewIdsForSourceIds: Object.fromEntries(Object.entries(filesList).map(\n    ([sourceId, { views }]) => [sourceId, calculateLocalStorageNextNewId(views, 0)]\n  )),\n});\n\nconst DEFAULT_VIEW_NAME = 'Unnamed View';\nconst DEFAULT_SOURCE_NAME = 'Unnamed Source';\n\nconst SOURCE_SAVED_TAG_FILTERS_LOCAL_STORAGE_KEY_PREFIX = 'sourceSavedTagFilters_';\n\nconst VIEW_SPEC_LOCAL_STORAGE_KEY_PREFIX = 'viewSpec_';\n\nconst SOURCE_CONTENT_LOCAL_STORAGE_KEY_PREFIX = 'sourceContent_';\n\nexport default {\n  doGetFilesList: async () => {\n    const sourceIdNames = doGetLocalStorageSourceIdNames();\n    if (!sourceIdNames) { return null; }\n    const filesList = {};\n    for (const [sourceId, sourceName] of Object.entries(sourceIdNames)) {\n      const sourceViews = doGetLocalStorageSourceViews(sourceId);\n      if (!sourceViews) { return null; }\n      filesList[sourceId] = { name: sourceName, views: sourceViews };\n    }\n    return filesList;\n  },\n  doSaveViewSpec: async (tagsList, sourceId, viewId, type, createNew) => {\n    const viewSpecLocalStorageKey = VIEW_SPEC_LOCAL_STORAGE_KEY_PREFIX + getFileIdKeyStr(sourceId, viewId);\n    if (tagsList.length > 0) { localStorage.setItem(viewSpecLocalStorageKey, JSON.stringify(tagsList)); }\n    else { localStorage.removeItem(viewSpecLocalStorageKey); }\n    return { id: viewId, sourceId, ...(createNew ? { name: DEFAULT_VIEW_NAME, type } : null) };\n  },\n  doGetView: async (fileId) => convertStrValueOrDefaultIfFalsy(\n    localStorage.getItem(VIEW_SPEC_LOCAL_STORAGE_KEY_PREFIX + getFileIdKeyStr(fileId.sourceId, fileId.viewId)),\n    [],\n    'invalid viewSpec',\n  ),\n  doGetSourceTaggedBlocks: async sourceId => {\n    const sourceContentDocStr = localStorage.getItem(SOURCE_CONTENT_LOCAL_STORAGE_KEY_PREFIX + sourceId);\n    if (!sourceContentDocStr) { return {}; }\n    const sourceContentDoc = convertStrValueOrDefault(sourceContentDocStr, null, 'invalid sourceContent');\n    if (!sourceContentDoc) { return null; }\n    const sourceTaggedBlocks = {};\n    if (sourceContentDoc) {\n      const nodes = [sourceContentDoc];\n      while (nodes.length > 0) {\n        const node = nodes.shift();\n        if (node.hasOwnProperty('attrs') && node.attrs.hasOwnProperty('tags')) {\n          for (const [tag, tagId] of Object.entries(node.attrs.tags)) { sourceTaggedBlocks[tagId] = { tag, node }; }\n        } else if (node.hasOwnProperty('content')) { nodes.push(...node.content); }\n      }\n    }\n    return sourceTaggedBlocks;\n  },\n  doSaveSourceContent: async (value, sourceId, createNew) => {\n    const saveValue = convertStrValueOrDefaultIfFalsy(\n      value,\n      '',\n      'invalid sourceContent value',\n      valueStr => {\n        JSON.parse(valueStr);\n        return valueStr;\n      },\n    );\n    if (saveValue === null) { return null; }\n    const sourceContentLocalStorageKey = SOURCE_CONTENT_LOCAL_STORAGE_KEY_PREFIX + sourceId;\n    if (saveValue) { localStorage.setItem(sourceContentLocalStorageKey, saveValue); }\n    else { localStorage.removeItem(sourceContentLocalStorageKey); }\n    return { id: sourceId, ...(createNew ? { name: DEFAULT_SOURCE_NAME } : null) };\n  },\n  doGetSourceContent: async sourceId => convertStrValueOrDefaultIfFalsy(\n    localStorage.getItem(SOURCE_CONTENT_LOCAL_STORAGE_KEY_PREFIX + sourceId),\n    '',\n    'invalid sourceContent',\n    valueStr => {\n      JSON.parse(valueStr);\n      return valueStr;\n    },\n  ),\n  // TODO add/remove single instead of set list\n  doSetSourceSavedTagFilters: async (sourceId, sourceSavedTagFilters) => {\n    const sourceSavedTagFiltersLocalStorageKey = SOURCE_SAVED_TAG_FILTERS_LOCAL_STORAGE_KEY_PREFIX + sourceId;\n    if (Object.keys(sourceSavedTagFilters).length > 0) {\n      localStorage.setItem(sourceSavedTagFiltersLocalStorageKey, JSON.stringify(sourceSavedTagFilters));\n    } else { localStorage.removeItem(sourceSavedTagFiltersLocalStorageKey); }\n    return true;\n  },\n  doGetSourceSavedTagFilters: async sourceId => convertStrValueOrDefaultIfFalsy(\n    localStorage.getItem(SOURCE_SAVED_TAG_FILTERS_LOCAL_STORAGE_KEY_PREFIX + sourceId),\n    {},\n    'invalid sourceSavedTagFilters',\n  ),\n  doDeleteView: async (sourceId, viewId) => {\n    localStorage.removeItem(VIEW_SPEC_LOCAL_STORAGE_KEY_PREFIX + getFileIdKeyStr(sourceId, viewId));\n    return true;\n  },\n  doDeleteSource: async (sourceId, localStorageSourceViewIds) => {\n    localStorage.removeItem(SOURCE_SAVED_TAG_FILTERS_LOCAL_STORAGE_KEY_PREFIX + sourceId);\n    localStorage.removeItem(SOURCE_CONTENT_LOCAL_STORAGE_KEY_PREFIX + sourceId);\n    for (const viewId of localStorageSourceViewIds) {\n      localStorage.removeItem(VIEW_SPEC_LOCAL_STORAGE_KEY_PREFIX + getFileIdKeyStr(sourceId, viewId));\n    }\n    localStorage.removeItem(SOURCE_VIEWS_LOCAL_STORAGE_KEY_PREFIX + sourceId);\n    return true;\n  },\n  doRenameView: async () => true,\n  doRenameSource: async () => true,\n};\n","import Cookies from 'js-cookie';\nimport axios from 'axios';\nimport {fetchWithTimeout} from '../util/FetchWithTimeout';\nimport {convertStrValueOrDefaultIfFalsy} from '../util/ConvertStrValueOrDefault';\nimport {ACCESS_TOKEN_COOKIE_KEY, SERVER_BASE_URL} from '../reducers/BackendModeSignedInStatus';\n\nconst EMPTY_SOURCE_CONTENT = { type: 'doc', content: [{ type: 'paragraph', attrs: { tags: {} } }] };\n\nexport default {\n  doGetFilesList: async () => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const response = await fetchWithTimeout(\n        SERVER_BASE_URL + `documents`,\n        { headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      if (response.ok) { return await response.json(); }\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doSaveViewSpec: async (tagsList, sourceId, viewId, type, createNew) => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const response = await fetchWithTimeout(\n        SERVER_BASE_URL + `view?docID=${sourceId}&viewType=${type}` + (!createNew ? `&viewID=${viewId}` : ''),\n        {\n          method: 'PUT',\n          body: JSON.stringify({ tags: tagsList }),\n          headers: new Headers({ 'Content-Type': 'application/json', 'Set-Cookie': `token=${token}` }),\n        },\n      );\n      if (response.ok) {\n        const { viewID } = await response.json();\n        return { id: viewID, sourceId: sourceId, ...(createNew ? { name:\"Untitled\", type } : null) };\n      };\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doGetView: async (fileId) => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const viewResponse = await fetchWithTimeout(\n        SERVER_BASE_URL + `view?docID=${fileId.sourceId}&viewID=${fileId.viewId}`,\n        { method: 'GET', headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      const tagResponse = await fetchWithTimeout(\n          SERVER_BASE_URL + `tags?docID=${fileId.sourceId}`,\n          { method: 'GET', headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      if (!viewResponse.ok || !tagResponse.ok) { return null; }\n      const view_json = await viewResponse.json();\n      const tags_json = await tagResponse.json();\n      return {\"view\": view_json, \"tags\": tags_json, \"type\": fileId.viewType};\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doGetSourceTaggedBlocks: async sourceId => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const response = await fetchWithTimeout(\n        SERVER_BASE_URL + `tags?docID=${sourceId}`,\n        { method: 'GET', headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      if (response.ok) { return await response.json(); };\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doSaveSourceContent: async (value, sourceId, createNew) => {\n    const saveValue = convertStrValueOrDefaultIfFalsy(\n      value,\n      JSON.stringify(EMPTY_SOURCE_CONTENT),\n      'invalid sourceContent value',\n      valueStr => {\n        JSON.parse(valueStr);\n        return valueStr;\n      },\n    );\n    if (!saveValue) { return null; }\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const response = await fetchWithTimeout(\n        SERVER_BASE_URL + 'document' + (!createNew ? `?docID=${sourceId}` : ''),\n        {\n          method: 'PUT',\n          body: saveValue,\n          headers: new Headers({ 'Content-Type': 'application/json', 'Set-Cookie': `token=${token}` }),\n        },\n      );\n      if (response.ok) {\n        const { id, name } = await response.json();\n        return { id: id, ...(createNew ? { name } : null) };\n      };\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doGetSourceContent: async sourceId => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const response = await fetchWithTimeout(\n        SERVER_BASE_URL + `document?docID=${sourceId}`,\n        { headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      if (response.ok) { return await response.text(); }\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doSetSourceSavedTagFilters: async (sourceId, sourceSavedTagFilters) => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    const filters = Object.keys(sourceSavedTagFilters);\n    try {\n      const response = await fetchWithTimeout(\n        SERVER_BASE_URL + `filters?docID=`,\n        {\n          method: 'POST',\n          body: JSON.stringify({ body: {\"docID\": sourceId, \"filters\": filters} }),\n          headers: new Headers({ 'Content-Type': 'application/json', 'Set-Cookie': `token=${token}` }),\n        },\n      );\n      if (response.ok) {\n        return true;\n      };\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doGetSourceSavedTagFilters: async sourceId => { // TODO\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const response = await fetchWithTimeout(\n        SERVER_BASE_URL + `filters?docID=${sourceId}`,\n        { headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      if (response.ok) { return await response.json(); }\n    } catch (e) { console.log(e); }\n    return null;\n  },\n  doDeleteSource: async sourceId => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const { ok } = await fetchWithTimeout(\n        SERVER_BASE_URL + `document?docID=${sourceId}`,\n        { method: 'DELETE', headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      return ok;\n    } catch (e) { console.log(e); }\n    return false;\n  },\n  doDeleteView: async (sourceId, viewId) => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const { ok } = await fetchWithTimeout(\n        SERVER_BASE_URL + `view?docID=${sourceId}&viewID=${viewId}`,\n        { method: 'DELETE', headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      return ok;\n    } catch (e) { console.log(e); }\n    return false;\n  },\n  doRenameSource: async (sourceId, name) => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const { ok } = await fetchWithTimeout(\n        SERVER_BASE_URL + `document?docID=${sourceId}&name=${name}`,\n        { method: 'PATCH', headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      return ok;\n    } catch (e) { console.log(e); }\n    return false;\n  },\n  doRenameView: async (sourceId, viewId, name) => {\n    const token = Cookies.get(ACCESS_TOKEN_COOKIE_KEY);\n    try {\n      const { ok } = await fetchWithTimeout(\n        SERVER_BASE_URL + `view?docID=${sourceId}&viewID=${viewId}&name=${name}`,\n        { method: 'PATCH', headers: new Headers({ 'Set-Cookie': `token=${token}` }) },\n      );\n      return ok;\n    } catch (e) { console.log(e); }\n    return false;\n  },\n};\n","import {BACKEND_MODE_SIGNED_IN_STATUS} from '../reducers/BackendModeSignedInStatus';\nimport LocalFileStorageSystemClient from './LocalFileStorageSystemClient';\nimport HostedFileStorageSystemClient from './HostedFileStorageSystemClient';\nimport store from '../store';\n\nconst getFileStorageSystemClient = () =>\n  store.getState().backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE\n    ? LocalFileStorageSystemClient : HostedFileStorageSystemClient;\n\nconst clientInterface = {\n  doGetFilesList: () => { throw new Error('not implemented'); },\n  doSaveViewSpec: () => { throw new Error('not implemented'); },\n  doGetView: () => { throw new Error('not implemented'); },\n  doGetSourceTaggedBlocks: () => { throw new Error('not implemented'); },\n  doSaveSourceContent: () => { throw new Error('not implemented'); },\n  doGetSourceContent: () => { throw new Error('not implemented'); },\n  doSetSourceSavedTagFilters: () => { throw new Error('not implemented'); },\n  doGetSourceSavedTagFilters: () => { throw new Error('not implemented'); },\n  doDeleteView: () => { throw new Error('not implemented'); },\n  doDeleteSource: () => { throw new Error('not implemented'); },\n  doRenameView: () => { throw new Error('not implemented'); },\n  doRenameSource: () => { throw new Error('not implemented'); },\n};\n\nexport default Object.keys(clientInterface).reduce(\n  (partial, key) => {\n    partial[key] = async (...args) => {\n      const fileStorageSystemClient = getFileStorageSystemClient();\n      return fileStorageSystemClient.hasOwnProperty(key)\n        ? (\n            store.getState().backendModeSignedInStatus !== BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_OUT\n              ? await fileStorageSystemClient[key](...args) : null\n          )\n        : clientInterface[key]();\n    };\n    return partial;\n  },\n  {},\n);\n","import './Editor.css';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {NO_OPEN_FILE_ID, checkNoOpenFileId, checkSourceFileId} from '../util/FileIdAndTypeUtils';\nimport {\n  CLEAR_SAVE_DIRTY_FLAG_ACTION_TYPE,\n  SET_SAVE_DIRTY_FLAG_ACTION_TYPE,\n} from '../reducers/CurrentOpenFileState';\nimport {TextSelection} from 'prosemirror-state';\nimport {handleSetCurrentOpenFileId} from './Navigator';\nimport TagMenu from './TagMenu';\nimport RichMarkdownEditor from 'rich-markdown-editor';\n\nimport store from '../store';\nimport FileStorageSystemClient from '../backend/FileStorageSystemClient';\nimport BlockTaggingEditorExtension from '../editor_extension/BlockTagging';\n\nexport const handleSaveCurrentFileEditorContent = () => {\n  const currentOpenFileId = store.getState().currentOpenFileId;\n  if (checkSourceFileId(store.getState().currentOpenFileId) && store.getState().saveDirtyFlag) {\n    FileStorageSystemClient.doSaveSourceContent(\n      BlockTaggingEditorExtension.editor.value(true),\n      currentOpenFileId.sourceId,\n    ).then(success => {\n      if (success) { store.dispatch({ type: CLEAR_SAVE_DIRTY_FLAG_ACTION_TYPE }); }\n      else { alert('failed to save source content'); }\n    });\n  }\n};\n\nclass Editor extends React.Component {\n  render = () => {\n    const noOpenFileIdCheck = checkNoOpenFileId(this.props.currentOpenFileId);\n    return (\n      <div className=\"MainPane\">\n        <div id=\"editor_container\">\n          <div id=\"editor\" hidden={noOpenFileIdCheck}>\n            <RichMarkdownEditor\n              extensions={[BlockTaggingEditorExtension]}\n              key={this.props.fileIdKeyStr}\n              defaultValue={this.props.fileContent}\n              jsonStrValue={!(!this.props.fileContent)}\n              onKeyDown={event => {\n                if (event.key === 'Escape') {\n                  BlockTaggingEditorExtension.editor.view.dispatch(\n                    BlockTaggingEditorExtension.editor.view.state.tr\n                      .setSelection(TextSelection.create(BlockTaggingEditorExtension.editor.view.state.doc, 0, 0))\n                  );\n                  event.target.blur();\n                }\n              }}\n              onChange={() => { if (!this.props.saveDirtyFlag) { this.props.dispatchSetSaveDirtyFlagAction(); } }}\n            />\n          </div>\n          <div\n            className=\"PlaceholderDivWithText\"\n            id=\"no_file_editor_placeholder\"\n            hidden={!noOpenFileIdCheck}>\n            <div style={{ flexGrow: 1 }} />\n            <div style={{ display: 'flex' }}>\n              <div style={{ flexGrow: 2 }} />\n              open a doc using the navigator side pane on the left\n              <div style={{ flexGrow: 3 }} />\n            </div>\n            <div style={{ flexGrow: 8 }} />\n          </div>\n        </div>\n        <TagMenu />\n      </div>\n    );\n  };\n};\n\nexport default connect(\n  state => ({ currentOpenFileId: state.currentOpenFileId, currentOpenFileName: state.currentOpenFileName, saveDirtyFlag: state.saveDirtyFlag }),\n  dispatch => ({ dispatchSetSaveDirtyFlagAction: () => dispatch({ type: SET_SAVE_DIRTY_FLAG_ACTION_TYPE }) }),\n)(Editor);\n","import './Editor.css';\nimport {defer} from 'lodash';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {NO_OPEN_FILE_ID, checkNoOpenFileId, checkSourceFileId, getFileIdKeyStr} from '../util/FileIdAndTypeUtils';\nimport Editor from './Editor';\nimport {handleSetCurrentOpenFileId} from './Navigator';\n\nimport FileStorageSystemClient from '../backend/FileStorageSystemClient';\nimport BlockTaggingEditorExtension from '../editor_extension/BlockTagging';\n\nexport const INITIAL_TAG_FILTERS_LOCAL_STORAGE_KEY = 'initialTagFilters';\n\nconst DEFAULT_STATE = {\n  fileIdKeyStr: getFileIdKeyStr(NO_OPEN_FILE_ID),\n  fileContent: '',\n};\n\nclass SourceEditorWithTagFiltersInput extends React.Component {\n\n  state = DEFAULT_STATE;\n\n  changeFile = async () => {\n    if (!checkNoOpenFileId(this.props.currentOpenFileId)) {\n      defer(() => {\n        BlockTaggingEditorExtension.editor.focusAtStart();\n      });\n    }\n    const fileIdKeyStr = getFileIdKeyStr(this.props.currentOpenFileId);\n    if (checkSourceFileId(this.props.currentOpenFileId)) {\n      FileStorageSystemClient.doGetSourceContent(this.props.currentOpenFileId.sourceId).then(value => {\n        if (value === null) {\n          alert('failed to retrieve source content');\n          handleSetCurrentOpenFileId(NO_OPEN_FILE_ID);\n        } else {\n          this.setState({fileIdKeyStr, fileContent: value ?? ''});\n        }\n      });\n    } else {\n      this.setState({fileIdKeyStr, fileContent: ''});\n    }\n  };\n\n  componentDidMount = () => {\n    this.changeFile();\n  };\n\n  componentDidUpdate = prevProps => {\n    if (\n      prevProps.currentOpenFileId.sourceId !== this.props.currentOpenFileId.sourceId ||\n      prevProps.currentOpenFileId.viewId !== this.props.currentOpenFileId.viewId\n    ) {\n      this.changeFile();\n    }\n  };\n\n  render = () => {\n    return (\n      <Editor fileIdKeyStr={this.state.fileIdKeyStr} fileContent={this.state.fileContent} />\n    );\n  };\n}\n\nexport default connect(state => ({ currentOpenFileId: state.currentOpenFileId , \n                                  currentOpenFileName: state.currentOpenFileName}))(SourceEditorWithTagFiltersInput);\n","import './Navigator.css';\nimport {debounce, defer} from 'lodash';\nimport Cookies from 'js-cookie';\nimport React from 'react';\nimport {batch, connect} from 'react-redux';\nimport {\n  FILE_TYPE,\n  NO_OPEN_FILE_ID,\n  validateFileIdObj,\n  checkNoOpenFileId,\n  checkSourceFileId,\n  checkViewFileId,\n  getFileIdKeyStr,\n} from '../util/FileIdAndTypeUtils';\nimport {INITIAL_TAG_FILTERS_LOCAL_STORAGE_KEY} from './SourceEditorWithTagFiltersInput';\nimport {\n  CLEAR_SAVE_DIRTY_FLAG_ACTION_TYPE,\n  INITIAL_FILE_ID_LOCAL_STORAGE_KEY,\n  INITIAL_FILE_NAME_LOCAL_STORAGE_KEY,\n  setCurrentOpenFileIdAction,\n  setCurrentOpenFileNameAction,\n  setSelectNodeAction,\n} from '../reducers/CurrentOpenFileState';\nimport {\n  ACCESS_TOKEN_COOKIE_KEY,\n  BACKEND_MODE_SIGNED_IN_STATUS,\n  getUserSignedInStatus,\n  setBackendModeSignedInStatusAction,\n} from '../reducers/BackendModeSignedInStatus';\nimport {\n  doSetLocalStorageSourceIdNames,\n  doSetLocalStorageSourceViews,\n  calculateLocalStorageNextNewId,\n  calculateLocalStorageNextNewFileIds,\n} from '../backend/LocalFileStorageSystemClient';\nimport Button from '@material-ui/core/Button';\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\nimport Input from '@material-ui/core/Input';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport SearchIcon from '@material-ui/icons/Search';\nimport Divider from '@material-ui/core/Divider';\nimport ListSubheader from '@material-ui/core/ListSubheader';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Collapse from '@material-ui/core/Collapse';\nimport ExpandLess from '@material-ui/icons/ExpandLess';\nimport ExpandMore from '@material-ui/icons/ExpandMore';\nimport Paper from '@material-ui/core/Paper';\nimport InputBase from '@material-ui/core/InputBase';\nimport IconButton from '@material-ui/core/IconButton';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport { makeStyles } from '@material-ui/core/styles';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport EditIcon from '@material-ui/icons/Edit';\nimport Popover from '@material-ui/core/Popover';\nimport store from '../store';\nimport FileStorageSystemClient from '../backend/FileStorageSystemClient';\nimport CheckIcon from '@material-ui/icons/Check';\nimport AddIcon from '@material-ui/icons/Add';\nimport TextFieldsIcon from '@material-ui/icons/TextFields';\nimport AmpStoriesIcon from '@material-ui/icons/AmpStories';\nimport Typography from '@material-ui/core/Typography';\n\nexport const handleSetCurrentOpenFileId = (fileId, fileName={\"sourceName\": '', \"viewName\": ''}) => {\n  if (!validateFileIdObj(fileId)) { return false; }\n  const currentOpenFileId = store.getState().currentOpenFileId;\n  if (fileId.sourceId === currentOpenFileId.sourceId && fileId.viewId === currentOpenFileId.viewId) { return true; }\n  if (!store.getState().saveDirtyFlag || window.confirm('confirm discard unsaved changes')) {\n    batch(() => {\n      store.dispatch(setCurrentOpenFileIdAction(fileId));\n      store.dispatch(setCurrentOpenFileNameAction(fileName));\n      store.dispatch({ type: CLEAR_SAVE_DIRTY_FLAG_ACTION_TYPE });\n      store.dispatch(setSelectNodeAction(null));\n    });\n    localStorage.setItem(INITIAL_FILE_ID_LOCAL_STORAGE_KEY, JSON.stringify(fileId));\n    localStorage.setItem(INITIAL_FILE_NAME_LOCAL_STORAGE_KEY, JSON.stringify(fileName));\n    localStorage.removeItem(INITIAL_TAG_FILTERS_LOCAL_STORAGE_KEY);\n    return true;\n  }\n  return false;\n};\n\nconst convertFilesListStateToFileIdNamesList = filesListState => Object.fromEntries(\n  Object.entries(filesListState).map(([id, { name }]) => [id, name])\n);\n\nconst countNumFiles = filesList => Object.entries(filesList)\n  .reduce((count, [_sourceId, { views }]) => count + 1 + Object.keys(views).length, 0);\n\nconst FILE_LIST_ID = 'file_list';\n\nconst SEARCH_FILE_NAMES_INPUT_ID = 'search_file_names_input';\n\nconst CURRENT_SOURCE_NAME_INPUT_ID = 'current_source_name_input';\nconst CURRENT_VIEW_NAME_INPUT_ID = 'current_view_name_input';\n\nconst RENAME_SOURCE_LIST_ITEM_INPUT_ID_PREFIX = 'rename_source_list_item_input_';\nconst RENAME_VIEW_LIST_ITEM_INPUT_ID_PREFIX = 'rename_view_list_item_input_';\n\nconst RENAME_INPUT_TYPES = {\n  CURRENT_SOURCE: 'CURRENT_SOURCE',\n  CURRENT_VIEW: 'CURRENT_VIEW',\n  SOURCE_LIST_ITEM: 'SOURCE_LIST_ITEM',\n  VIEW_LIST_ITEM: 'VIEW_LIST_ITEM',\n};\n\nconst getRenameInputIdFunctions = {\n  [RENAME_INPUT_TYPES.CURRENT_SOURCE]: () => CURRENT_SOURCE_NAME_INPUT_ID,\n  [RENAME_INPUT_TYPES.CURRENT_VIEW]: () => CURRENT_VIEW_NAME_INPUT_ID,\n  [RENAME_INPUT_TYPES.SOURCE_LIST_ITEM]: fileId => RENAME_SOURCE_LIST_ITEM_INPUT_ID_PREFIX + fileId.sourceId,\n  [RENAME_INPUT_TYPES.VIEW_LIST_ITEM]: fileId => RENAME_VIEW_LIST_ITEM_INPUT_ID_PREFIX + getFileIdKeyStr(fileId),\n};\n\nconst NO_RENAMING_STATE = { inputType: null, fileId: NO_OPEN_FILE_ID };\n\nconst DEFAULT_STATE = {\n  searching: '',\n  renaming: NO_RENAMING_STATE,\n  filesList: {},\n  nextNewFileIds: null,\n  selectedFileId: null,\n  selectedViewId: null,\n  selectedFileOpen: false,\n  editMenuAnchorElement: null,\n  renameSelected: false,\n  newViewAnchorElement: null\n};\n\nclass FileListItem extends React.Component {\n  render = () => {\n    if(this.props.fileId.viewId !== 0){\n      const viewType = this.props.viewType;\n      return (\n        <div className={\"fileList-viewRoot\"} style={(this.props.selected) ? \n                                                  {backgroundColor: 'rgba(30, 61, 89, 0.3)', width:\"100%\", display: \"flex\", padding: \"2px 4px\", alignItems: \"center\"} : \n                                                  {width:\"100%\", display: \"flex\", padding: \"2px 4px\", alignItems: \"center\"} }>\n          <IconButton>\n            {\n              (viewType === FILE_TYPE.CARD_VIEW) ? \n              <AmpStoriesIcon color=\"primary\"/>:\n              (viewType === FILE_TYPE.TEXT_VIEW) ?\n             <TextFieldsIcon color=\"primary\"/> :\n              null\n            }\n          </IconButton>\n          <InputBase \n            value={this.props.fileName}\n            className=\"file_list_input\"\n            disabled={!(this.props.selected && this.props.renameSelected)}\n            style={{color: \"#1E3D59\"}}\n          />\n          <Divider className={\"fileList-divider\"} orientation=\"vertical\" />\n          <IconButton className={\"fileList-iconButton\"} onClick={this.props.handleEditMenuClick}>\n            <MoreVertIcon fontSize=\"small\" color=\"primary\"/>\n          </IconButton>\n        </div>\n      );\n    }else{\n      return (\n        <div className={\"fileList-viewRoot\"} style={(this.props.selected) ? \n                                                      {backgroundColor: 'rgba(30, 61, 89, 0.3)', border:\"solid #3f51b5 thin\", width:\"100%\", display: \"flex\", padding: \"2px 4px\", alignItems: \"center\"} :\n                                                       {width:\"100%\", display: \"flex\", padding: \"2px 4px\", alignItems: \"center\"} }>\n          <InputBase \n            value={this.props.fileName}\n            className=\"file_list_input\"\n            disabled={!(this.props.selected && this.props.renameSelected)}\n            style={{color: \"#1E3D59\"}}\n          />\n          {this.props.childViewsExist ? (this.props.open ? <ExpandLess /> : <ExpandMore />) : null}\n          <Divider className={\"fileList-divider\"} orientation=\"vertical\" />\n          <IconButton className={\"fileList-iconButton\"} onClick={this.props.handleEditMenuClick}>\n            <MoreVertIcon fontSize=\"small\" color=\"primary\"/>\n          </IconButton>\n        </div>\n      );\n    }\n  }\n};\n\nclass Navigator extends React.Component {\n  \n  state = DEFAULT_STATE;\n\n  resetState = () => { this.setState(DEFAULT_STATE); }\n\n  getSourceName = fileId => validateFileIdObj(fileId) && this.state.filesList.hasOwnProperty(fileId.sourceId)\n      ? this.state.filesList[fileId.sourceId].name : '';\n  \n  getViewName = fileId => checkViewFileId(fileId) && this.state.filesList.hasOwnProperty(fileId.sourceId) &&\n    this.state.filesList[fileId.sourceId].views.hasOwnProperty(fileId.viewId)\n      ? this.state.filesList[fileId.sourceId].views[fileId.viewId].name : '';\n\n  getFileName = fileId => checkViewFileId(fileId) ? this.getViewName(fileId) : this.getSourceName(fileId);\n\n  getRenameInputValueFunctions = {\n    [RENAME_INPUT_TYPES.CURRENT_SOURCE]: this.getSourceName,\n    [RENAME_INPUT_TYPES.CURRENT_VIEW]: this.getViewName,\n    [RENAME_INPUT_TYPES.SOURCE_LIST_ITEM]: this.getFileName,\n    [RENAME_INPUT_TYPES.VIEW_LIST_ITEM]: this.getFileName,\n  };\n\n  handleSwitchBackendModeSignedInStatus = status => {\n    if (status === this.props.backendModeSignedInStatus) { return true; }\n    if (handleSetCurrentOpenFileId(NO_OPEN_FILE_ID)) {\n      this.resetState();\n      this.props.dispatchSetBackendModeSignedInStatusAction(status);\n      return true;\n    }\n    return false;\n  };\n\n  handleCancelRenaming = (inputType, fileId) => {\n    const input = document.getElementById(getRenameInputIdFunctions[inputType](fileId));\n    input.value = this.getRenameInputValueFunctions[inputType](fileId);\n    input.setSelectionRange(0, 0);\n    this.setState({ renaming: NO_RENAMING_STATE });\n  };\n\n  handleClearSearchingInput = () => {\n    document.getElementById(SEARCH_FILE_NAMES_INPUT_ID).value = '';\n    this.setState({ searching: '' });\n  };\n\n  handleChangeSearchingInput = () => {\n    this.setState({ searching: document.getElementById(SEARCH_FILE_NAMES_INPUT_ID).value.trim() });\n  };\n\n  handleDoFileNamesSearch = () => Object.fromEntries(\n    Object.entries(this.state.filesList).map(([sourceId, { name: sourceName, views }]) => [\n      sourceId,\n      {\n        name: sourceName,\n        views: this.state.searching\n          ? Object.fromEntries(Object.entries(views).filter(\n              ([_viewId, { name: viewName }]) => viewName.includes(this.state.searching)\n            ))\n          : views,\n      },\n    ]).filter(\n      ([_sourceId, { name: sourceName, views }]) => !this.state.searching ||\n        Object.keys(views).length > 0 || sourceName.includes(this.state.searching)\n    )\n  );\n\n  handleCreateNewFile = async fileType => {\n    if (!FILE_TYPE.hasOwnProperty(fileType)) { return; }\n    const sourceFileType = fileType === FILE_TYPE.SOURCE;\n    const noOpenFileIdCheck = checkNoOpenFileId(this.props.currentOpenFileId);\n    if (\n      (noOpenFileIdCheck && !sourceFileType) ||\n      (!noOpenFileIdCheck && !handleSetCurrentOpenFileId(NO_OPEN_FILE_ID))\n    ) { return; }\n    const localStorageNextNewFileId =\n      this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE\n        ? (\n            sourceFileType\n              ? this.state.nextNewFileIds.source\n              : this.state.nextNewFileIds.nextNewViewIdsForSourceIds[this.props.currentOpenFileId.sourceId]\n          )\n        : null;\n    const newFilePromise = sourceFileType\n      ? FileStorageSystemClient.doSaveSourceContent(null, localStorageNextNewFileId, true)\n      : FileStorageSystemClient.doSaveViewSpec(\n          [],\n          this.props.currentOpenFileId.sourceId,\n          localStorageNextNewFileId,\n          fileType,\n          true,\n        );\n    const newFile = await newFilePromise;\n    if (!newFile) {\n      alert('failed to create new file');\n      return;\n    }\n    const updatedSourceId = sourceFileType ? newFile.id : this.state.selectedFileId;\n    const newFilesList = {\n      ...this.state.filesList,\n      [updatedSourceId]: {\n        name: sourceFileType ? newFile.name : this.state.filesList[updatedSourceId].name,\n        views: {\n          ...(\n            !sourceFileType\n              ? {\n                  ...this.state.filesList[updatedSourceId].views,\n                  [newFile.id]: { name: newFile.name, type: newFile.type },\n                }\n              : null\n          ),\n        },\n      },\n    };\n    this.setState({ filesList: newFilesList });\n    defer(() => {\n      const fileId = { sourceId: updatedSourceId, viewId: !sourceFileType ? newFile.id : 0 };\n      const fileName = {sourceName: this.getSourceName(fileId), viewName: this.getViewName(fileId)};\n      handleSetCurrentOpenFileId(fileId, fileName);\n    });\n    if (this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE) {\n      if (sourceFileType) { doSetLocalStorageSourceIdNames(convertFilesListStateToFileIdNamesList(newFilesList)); }\n      else { doSetLocalStorageSourceViews(updatedSourceId, newFilesList[updatedSourceId].views); }\n      this.setState({\n        nextNewFileIds: {\n          source: sourceFileType\n            ? calculateLocalStorageNextNewId(newFilesList, parseInt(updatedSourceId))\n            : this.state.nextNewFileIds.source,\n          nextNewViewIdsForSourceIds: {\n            ...this.state.nextNewFileIds.nextNewViewIdsForSourceIds,\n            ...(\n              !sourceFileType\n                ? {\n                    [updatedSourceId]:\n                      calculateLocalStorageNextNewId(newFilesList[updatedSourceId].views, parseInt(newFile.id)),\n                  }\n                : null\n            ),\n          },\n        },\n      });\n    }\n  }\n\n  handleDeleteFile = async fileId => {\n    if (checkNoOpenFileId(fileId)) { return; }\n    if (\n      fileId.sourceId === this.props.currentOpenFileId.sourceId &&\n      fileId.viewId === this.props.currentOpenFileId.viewId &&\n      !handleSetCurrentOpenFileId(NO_OPEN_FILE_ID)\n    ) { return; }\n    const sourceFileIdCheck = checkSourceFileId(fileId);\n    const deleteFilePromise = sourceFileIdCheck\n      ? FileStorageSystemClient.doDeleteSource(\n          fileId.sourceId,\n          Object.keys(this.state.filesList[fileId.sourceId].views),\n        )\n      : FileStorageSystemClient.doDeleteView(fileId.sourceId, fileId.viewId);\n    const success = await deleteFilePromise;\n    if (!success) {\n      alert('failed to delete file');\n      return;\n    }\n    const newFilesList = {...this.state.filesList};\n    if (sourceFileIdCheck) { delete newFilesList[fileId.sourceId]; }\n    else {\n      const newSourceViews = {...newFilesList[fileId.sourceId].views};\n      delete newSourceViews[fileId.viewId];\n      newFilesList[fileId.sourceId] = { name: newFilesList[fileId.sourceId].name, views: newSourceViews };\n    }\n    this.setState({ filesList: newFilesList });\n    if (this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE) {\n      if (sourceFileIdCheck) {\n        doSetLocalStorageSourceIdNames(convertFilesListStateToFileIdNamesList(newFilesList));\n        const newNextNewViewIdsForSourceIds = {...this.state.nextNewFileIds.nextNewViewIdsForSourceIds};\n        delete newNextNewViewIdsForSourceIds[fileId.sourceId];\n        this.setState({\n          nextNewFileIds: {\n            source: this.state.nextNewFileIds.source,\n            nextNewViewIdsForSourceIds: newNextNewViewIdsForSourceIds,\n          },\n        });\n      } else { doSetLocalStorageSourceViews(fileId.sourceId, newFilesList[fileId.sourceId].views); }\n    }\n  };\n\n  handleRenameFile = async (fileId) => {\n    if (checkNoOpenFileId(fileId)) { return; }\n    const input = document.getElementById(\"rename_field\");\n    if (!input) { return; }\n    const newName = input.value.trim();\n    if (!newName || newName === this.getFileName(fileId)) { return; }\n    const sourceFileIdCheck = checkSourceFileId(fileId);\n    const renameFilePromise = sourceFileIdCheck\n      ? FileStorageSystemClient.doRenameSource(fileId.sourceId, newName)\n      : FileStorageSystemClient.doRenameView(fileId.sourceId, fileId.viewId, newName);\n    const success = await renameFilePromise;\n    if (!success) {\n      alert('failed to rename file');\n      return;\n    }\n    const newFilesList = {...this.state.filesList};\n    if (sourceFileIdCheck) {\n      newFilesList[fileId.sourceId] = { name: newName, views: newFilesList[fileId.sourceId].views };\n    } else {\n      const newSourceViews = {\n        ...newFilesList[fileId.sourceId].views,\n        [fileId.viewId]: { ...newFilesList[fileId.sourceId].views[fileId.viewId], name: newName },\n      };\n      newFilesList[fileId.sourceId] = { name: newFilesList[fileId.sourceId].name, views: newSourceViews };\n    }\n    this.setState({ filesList: newFilesList });\n    if (this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE) {\n      if (sourceFileIdCheck) { doSetLocalStorageSourceIdNames(convertFilesListStateToFileIdNamesList(newFilesList)); }\n      else { doSetLocalStorageSourceViews(fileId.sourceId, newFilesList[fileId.sourceId].views); }\n    }\n  };\n\n  componentDidMount = () => {\n    this.setState({\n      selectedFileId : this.props.currentOpenFileId.sourceId,\n      selectedViewId: this.props.currentOpenFileId.viewId,\n      selectedFileOpen: this.props.currentOpenFileId.viewId != 0\n    })\n    FileStorageSystemClient.doGetFilesList().then(filesList => {\n      if (!filesList) { alert('failed to retrieve files list'); }\n      else { this.setState({ filesList }); }\n      if (this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE) {\n        this.setState({ nextNewFileIds: calculateLocalStorageNextNewFileIds(this.state.filesList) });\n      }\n    });\n  };\n\n  componentDidUpdate = (prevProps, prevState) => {\n    if (prevProps.backendModeSignedInStatus !== this.props.backendModeSignedInStatus) {\n      FileStorageSystemClient.doGetFilesList().then(filesListValue => filesListValue ?? {}).then(filesList => {\n        this.setState({\n          ...DEFAULT_STATE,\n          filesList,\n          nextNewFileIds: this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE\n            ? calculateLocalStorageNextNewFileIds(filesList) : null,\n        });\n      });\n    }\n  };\n  \n  renameInput = ({ inputType, fileId, ...remainingProps }) => {\n    const inputId = getRenameInputIdFunctions[inputType](fileId);\n    const value = this.getRenameInputValueFunctions[inputType](fileId);\n    return (\n      <input\n        id={inputId}\n        defaultValue={value}\n        placeholder={value}\n        disabled={\n          checkNoOpenFileId(fileId) || this.state.renaming.inputType !== inputType ||\n          this.state.renaming.fileId.sourceId !== fileId.sourceId ||\n          this.state.renaming.fileId.viewId !== fileId.viewId\n        }\n        onBlur={() => {\n          this.handleRenameFile(inputType, fileId).then(() => {\n            if (\n              this.state.renaming.inputType === inputType && this.state.renaming.fileId.sourceId === fileId.sourceId &&\n              this.state.renaming.fileId.viewId === fileId.viewId\n            ) { this.handleCancelRenaming(inputType, fileId); }\n          });\n        }}\n        onKeyDown={event => { if (event.key === 'Escape') { this.handleCancelRenaming(inputType, fileId); } }}\n        onKeyPress={event => { if (event.key === 'Enter') { event.target.blur(); } }}\n        {...remainingProps}\n      />\n    );\n  };\n\n  handleFileListClick = (fileId) => {\n    if (fileId === this.state.selectedFileId) {\n      handleSetCurrentOpenFileId({ sourceId:fileId, viewId: 0, viewType: FILE_TYPE.EMPTY}, {sourceName: this.state.filesList[fileId].name, viewName: ''});\n      this.setState({\n        selectedViewId: null,\n        selectedFileOpen: !(this.state.selectedFileOpen)\n      });\n    }else{\n      if(handleSetCurrentOpenFileId({ sourceId:fileId, viewId: 0, viewType: FILE_TYPE.EMPTY}, {sourceName: this.state.filesList[fileId].name, viewName: ''})){\n        this.setState({\n          selectedFileId: fileId,\n          selectedViewId: null,\n          selectedFileOpen: true\n        });\n      }\n    }\n    \n  };\n\n  handleViewListClick = (fileId) => {\n    const fileName = {sourceName: this.getSourceName(fileId), viewName: this.getViewName(fileId)};\n    handleSetCurrentOpenFileId(fileId, fileName);\n    this.setState({\n      selectedViewId: fileId.viewId,\n    });\n  };\n\n  handleEditMenuClick = (event) => {\n    this.setState({\n      editMenuAnchorElement: event.currentTarget\n    })\n  }\n\n  handleEditMenuClose = () => {\n    this.setState({\n      editMenuAnchorElement: null\n    })\n  }\n\n  handleDeleteMenuClick = () => {\n    this.handleEditMenuClose();\n    const fileId = { sourceId: this.state.selectedFileId, viewId: (this.state.selectedViewId === null) ? 0 : this.state.selectedViewId}\n    this.handleDeleteFile(fileId).then(success => {\n      if (fileId.viewId !== 0) {\n        this.setState({\n          selectedViewId: null,\n        });\n      }else{\n        this.setState({\n          selectedFileId: null,\n          selectedViewId: null,\n          selectedFileOpen: false\n        });\n      }\n    });\n  }\n\n  handleRenameMenuClick = (event) => {\n    this.setState({\n      renamePopoverElement: this.state.editMenuAnchorElement,\n      editMenuAnchorElement: null\n    })\n  }\n\n  handleRenamePopoverClose = () => {\n    this.setState({\n      renamePopoverElement: null\n    })\n  }\n\n  handleViewMenuOpen = (event) => {\n    this.setState({\n      newViewAnchorElement : this.state.editMenuAnchorElement\n    })\n  }\n\n  handleViewMenuClose = () => {\n    this.setState({\n      newViewAnchorElement : null,\n      editMenuAnchorElement: null\n    })\n  }\n\n  render = () => {\n    const noOpenFileIdCheck = checkNoOpenFileId(this.props.currentOpenFileId);\n    const currentSourceRenameComponentProps = {\n      inputType: RENAME_INPUT_TYPES.CURRENT_SOURCE,\n      fileId: { sourceId: this.props.currentOpenFileId.sourceId, viewId: 0 },\n    };\n    const currentViewRenameComponentProps = {\n      inputType: RENAME_INPUT_TYPES.CURRENT_VIEW,\n      fileId: this.props.currentOpenFileId,\n    };\n    const numFiles = countNumFiles(this.state.filesList);\n    const filteredFilesList = this.state.searching ? this.handleDoFileNamesSearch() : this.state.filesList;\n    const numFilteredFiles = countNumFiles(filteredFilesList);\n    return (\n      <div className=\"SidePane\">\n        <div id=\"file_list_container\">\n            <Button\n              variant=\"outlined\"\n              color=\"primary\"\n              endIcon={<AddCircleIcon />}\n              disableElevation\n              id=\"new_document_button\"\n              onClick={() => { this.handleCreateNewFile(FILE_TYPE.SOURCE); }}\n            >\n              New Document\n            </Button>\n          <div className=\"InputRow\" id=\"search_file_names_input_row\">\n            <Input\n              variant=\"outlined\"\n              id={SEARCH_FILE_NAMES_INPUT_ID}\n              startAdornment={\n                <InputAdornment position=\"start\">\n                  <SearchIcon />\n                </InputAdornment>\n              }\n              style={{\"width\":\"100%\"}}\n              title=\"Search File Names\"\n              placeholder=\"Search File Names\"\n              onChange={debounce(this.handleChangeSearchingInput, 150)}\n              onKeyPress={event => { if (event.key === 'Enter') { event.target.blur(); } }}\n              onKeyDown={event => { if (event.key === 'Escape') { event.target.blur(); } }}\n            />\n          </div>\n          {\n            Object.keys(filteredFilesList).length > 0\n              ?  <List\n                    component=\"nav\"\n                    aria-labelledby=\"nested-list-subheader\"\n                    subheader={\n                      <ListSubheader component=\"div\" id=\"nested-list-subheader\">\n                        Source Files\n                      </ListSubheader>\n                    }\n                    id={FILE_LIST_ID}\n                    style={{\"maxWidth\" : 360, \"width\" : '100%'}}\n                  >\n                  {\n                    Object.entries(filteredFilesList).map(([sourceId, { views }]) =>\n                    <div>\n                      <ListItem button \n                      key={sourceId} \n                      disableGutters={true}\n                      divider={true}\n                      style={{\"padding\":\"0px\"}}\n                      onClick={() => {this.handleFileListClick(sourceId)}}\n                      >\n                        <FileListItem\n                          fileId={{ sourceId, viewId: 0 }}\n                          selected={sourceId === this.state.selectedFileId}\n                          open={sourceId === this.state.selectedFileId && this.state.selectedFileOpen}\n                          handleEditMenuClick={this.handleEditMenuClick}\n                          childViewsExist={Object.keys(views).length > 0}\n                          fileName={this.getFileName({ sourceId, viewId: 0 })}\n                          renameSelected={this.state.renameSelected}\n                          handleEditMenuClick={this.handleEditMenuClick}\n                        />\n                      </ListItem>\n                        {\n                          Object.keys(views).length > 0\n                            ? <Collapse in={sourceId === this.state.selectedFileId && this.state.selectedFileOpen} timeout=\"auto\" unmountOnExit>\n                                <List component=\"div\" disablePadding style={{\"borderStyle\": \"none solid solid solid\", \"borderColor\" :\"#3f51b5\", \"borderWidth\": \"thin\", \"borderRadius\": \"4px\"}}>\n                                {\n                                  Object.keys(views).map(viewId => {\n                                    const fileId = { sourceId, viewId, \"viewType\": views[viewId].type };\n                                    return (\n                                      <ListItem button \n                                      key={getFileIdKeyStr(fileId)} \n                                      disableGutters={true}\n                                      divider={true}\n                                      style={{ \"paddingTop\": \"0px\", \"paddingBottom\": \"0px\", \"backgroundColor\": \"transparent\"}}\n                                      onClick={() => {this.handleViewListClick(fileId)}}\n                                      >\n                                      <FileListItem\n                                          fileId={fileId}\n                                          open={viewId === this.state.selectedViewId}\n                                          handleEditMenuClick={this.handleEditMenuClick}\n                                          fileName={this.getFileName(fileId)}\n                                          viewType={views[viewId].type}\n                                          renameSelected={this.state.renameSelected}\n                                          selected={viewId === this.state.selectedViewId}\n                                          handleEditMenuClick={this.handleEditMenuClick}\n                                        />\n                                      </ListItem>\n                                    );\n                                  })\n                                }\n                                </List>\n                              </Collapse>\n                            : null\n                          }\n                          </div>   \n                    )\n                  }\n                </List>\n              : <div className=\"PlaceholderDivWithText\" id=\"no_files_placeholder\">\n                  No Files\n                </div>\n          }\n          <Menu\n            id=\"edit_menu\"\n            anchorEl={this.state.editMenuAnchorElement}\n            keepMounted\n            open={Boolean(this.state.editMenuAnchorElement)}\n            onClose={() => this.handleEditMenuClose()}\n            anchorOrigin={{\n              vertical: 'bottom',\n              horizontal: 'center',\n            }}\n            transformOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n          >\n            {\n              (this.state.selectedViewId === null) ? \n              <MenuItem onClick={() => this.handleViewMenuOpen()}>\n                <ListItemIcon>\n                  <AddIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText primary=\"New View\" />\n              </MenuItem>\n              : null\n            }\n              <MenuItem onClick={() => this.handleRenameMenuClick()}>\n                <ListItemIcon>\n                  <EditIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText primary=\"Rename\" />\n              </MenuItem>\n              <MenuItem onClick={() => this.handleDeleteMenuClick()}>\n                <ListItemIcon>\n                  <DeleteIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText primary=\"Delete\" />\n              </MenuItem>\n          </Menu>\n          <Menu \n            id=\"viewMenu\"\n            anchorEl={this.state.newViewAnchorElement}\n            keepMounted\n            open={Boolean(this.state.newViewAnchorElement)}\n            onClose={() => this.handleViewMenuClose()}\n            anchorOrigin={{\n              vertical: 'bottom',\n              horizontal: 'center',\n            }}\n            transformOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n          >\n              <MenuItem \n                  onClick={() => {\n                    this.handleViewMenuClose();\n                    this.handleCreateNewFile(FILE_TYPE.TEXT_VIEW);}}\n              >\n                <ListItemIcon>\n                  <TextFieldsIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText primary=\"Text View\" />\n              </MenuItem>\n              <MenuItem\n              onClick={() => {\n                this.handleViewMenuClose();\n                this.handleCreateNewFile(FILE_TYPE.CARD_VIEW);}}\n              >\n                <ListItemIcon>\n                  <AmpStoriesIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText primary=\"Card View\" />\n              </MenuItem>\n          </Menu>\n          <Popover\n            open={Boolean(this.state.renamePopoverElement)}\n            anchorEl={this.state.renamePopoverElement}\n            anchorOrigin={{\n              vertical:'top',\n              horizontal: 'right'\n            }}\n            transformOrigin={{\n              vertical:'top',\n              horizontal: 'right'\n            }}\n            id=\"rename_popover\"\n          >\n            <Input\n              id=\"rename_field\"\n              defaultValue={this.getFileName({sourceId: this.state.selectedFileId, viewId: (this.state.selectedViewId == null) ? 0 : this.state.selectedViewId})}\n              onKeyPress={event => {\n                if(event.key === 'Enter') {\n                    this.handleRenameFile({sourceId: this.state.selectedFileId, viewId: (this.state.selectedViewId == null) ? 0 : this.state.selectedViewId})\n                    this.handleRenamePopoverClose();\n                }   \n              }}\n              onKeyDown={event => {\n                if(event.key === 'Escape') {\n                    this.handleRenamePopoverClose();\n                }   \n              }}\n              endAdornment={\n                <InputAdornment position=\"end\">\n                  <IconButton \n                    onClick= {() => {\n                      this.handleRenameFile({sourceId: this.state.selectedFileId, viewId: (this.state.selectedViewId == null) ? 0 : this.state.selectedViewId})\n                      this.handleRenamePopoverClose();\n                    }}\n                  >\n                      <CheckIcon/>\n                  </IconButton>\n                </InputAdornment>\n              }\n              disableUnderline={true}\n              fullWidth={true}\n              style={{height:\"50px\", \"paddingLeft\": \"10px\"}}\n            />\n          </Popover>\n          <div\n            className=\"PlaceholderDivWithText\"\n            id=\"filtered_files_placeholder\"\n            hidden={!this.state.searching}>\n            {(numFiles - numFilteredFiles) + ' of ' + (numFiles) + ' files hidden by search'}\n          </div>\n        </div>\n        <div id=\"user_controls_container\">\n          {\n            this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_IN\n              ? <Button\n                  variant=\"outlined\"\n                  onClick={() => {\n                    if (\n                      this.props.dispatchSetBackendModeSignedInStatusAction(\n                        BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_OUT\n                      )\n                    ) { Cookies.remove(ACCESS_TOKEN_COOKIE_KEY); }\n                  }}>\n                  Sign out\n                </Button>\n              : null\n          }\n          <Button\n            variant=\"outlined\"\n            onClick={() => {\n              if (this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE) {\n                getUserSignedInStatus().then(backendModeSignedInStatus => {\n                  this.handleSwitchBackendModeSignedInStatus(backendModeSignedInStatus);\n                });\n              } else { this.handleSwitchBackendModeSignedInStatus(BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE); }\n            }}>\n            {\n              'Switch to ' +\n              (\n                this.props.backendModeSignedInStatus === BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE\n                  ? 'cloud' : 'local'\n              ) + ' storage'\n            }\n          </Button>\n        </div>\n      </div>\n    );\n  };\n};\n\nexport default connect(\n  state => ({\n    currentOpenFileId: state.currentOpenFileId,\n    backendModeSignedInStatus: state.backendModeSignedInStatus,\n  }),\n  dispatch => ({\n    dispatchSetBackendModeSignedInStatusAction: mode => dispatch(setBackendModeSignedInStatusAction(mode)),\n  }),\n)(Navigator);\n","import nearley from 'nearley';\n// Generated automatically by nearley, version undefined\n// http://github.com/Hardmath123/nearley\n/*\nMain -> Expression {% id %}\nExpression -> Expression_ {% id %} | Factor {% id %}\nExpression_ -> Factor _ \"|\" _ Expression {% function(d) { return [d[0], d[2], d[4]] } %}\nFactor -> Factor_ {% id %} | Term {% id %}\nFactor_ -> Term _ \"&\" _ Factor {% function(d) { return [d[0], d[2], d[4]] } %}\nTerm -> Not {% id %} | Nested {% id %} | Tag {% id %}\nNot -> \"!\" (Nested {% id %} | Tag {% id %})\nNested -> \"(\" _ Expression _ \")\" {% function(d) { return d[2] } %}\nTag -> \"#{\" [^{}]:+ \"}\" {% function(d) { return [d[0], d[1].join(\"\"), d[2]].join(\"\") } %}\n_ -> \" \":* {% function(d) { return null } %}\n*/\nfunction id(x) {\n  return x[0];\n}\nconst Grammar = {\n  Lexer: undefined,\n  ParserRules: [\n    { name: \"Main\", symbols: [\"Expression\"], postprocess: id },\n    { name: \"Expression\", symbols: [\"Expression_\"], postprocess: id },\n    { name: \"Expression\", symbols: [\"Factor\"], postprocess: id },\n    {\n      name: \"Expression_\",\n      symbols: [\"Factor\", \"_\", { literal: \"|\", pos: 30 }, \"_\", \"Expression\"],\n      postprocess: function(d) {\n        return [d[0], d[2], d[4]];\n      },\n    },\n    { name: \"Factor\", symbols: [\"Factor_\"], postprocess: id },\n    { name: \"Factor\", symbols: [\"Term\"], postprocess: id },\n    {\n      name: \"Factor_\",\n      symbols: [\"Term\", \"_\", { literal: \"&\", pos: 60 }, \"_\", \"Factor\"],\n      postprocess: function(d) {\n        return [d[0], d[2], d[4]];\n      },\n    },\n    { name: \"Term\", symbols: [\"Not\"], postprocess: id },\n    { name: \"Term\", symbols: [\"Nested\"], postprocess: id },\n    { name: \"Term\", symbols: [\"Tag\"], postprocess: id },\n    { name: \"Not$subexpression$1\", symbols: [\"Nested\"], postprocess: id },\n    { name: \"Not$subexpression$1\", symbols: [\"Tag\"], postprocess: id },\n    {\n      name: \"Not\",\n      symbols: [{ literal: \"!\", pos: 92 }, \"Not$subexpression$1\"],\n    },\n    {\n      name: \"Nested\",\n      symbols: [\n        { literal: \"(\", pos: 110 },\n        \"_\",\n        \"Expression\",\n        \"_\",\n        { literal: \")\", pos: 118 },\n      ],\n      postprocess: function(d) {\n        return d[2];\n      },\n    },\n    {\n      name: \"Tag$string$1\",\n      symbols: [{ literal: \"#\" }, { literal: \"{\" }],\n      postprocess: function joiner(d) {\n        return d.join(\"\");\n      },\n    },\n    { name: \"Tag$ebnf$1\", symbols: [/[^{}]/] },\n    {\n      name: \"Tag$ebnf$1\",\n      symbols: [/[^{}]/, \"Tag$ebnf$1\"],\n      postprocess: function arrconcat(d) {\n        return [d[0]].concat(d[1]);\n      },\n    },\n    {\n      name: \"Tag\",\n      symbols: [\"Tag$string$1\", \"Tag$ebnf$1\", { literal: \"}\", pos: 131 }],\n      postprocess: function(d) {\n        return d[1].join(\"\").trim();\n      },\n    },\n    { name: \"_$ebnf$1\", symbols: [] },\n    {\n      name: \"_$ebnf$1\",\n      symbols: [{ literal: \" \", pos: 139 }, \"_$ebnf$1\"],\n      postprocess: function arrconcat(d) {\n        return [d[0]].concat(d[1]);\n      },\n    },\n    {\n      name: \"_\",\n      symbols: [\"_$ebnf$1\"],\n      postprocess: function(d) {\n        return null;\n      },\n    },\n  ],\n  ParserStart: \"Main\",\n};\nexport const parse = (inputText, throwErrors = true) => {\n  let outputParsedExpr = null;\n  if (inputText) {\n    const parser = new nearley.Parser(nearley.Grammar.fromCompiled(Grammar));\n    try {\n      parser.feed(inputText.trim());\n      if (parser.results.length > 0) {\n        outputParsedExpr = parser.results;\n      }\n    } catch (ex) {}\n  }\n  return outputParsedExpr;\n};\n","import React from 'react';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport {connect} from 'react-redux';\nimport {setBackendModeSignedInStatusAction} from '../reducers/BackendModeSignedInStatus';\nimport Breadcrumbs from '@material-ui/core/Breadcrumbs';\nimport DescriptionIcon from '@material-ui/icons/Description';\nimport Link from '@material-ui/core/Link';\nimport TextFieldsIcon from '@material-ui/icons/TextFields';\nimport AmpStoriesIcon from '@material-ui/icons/AmpStories';\nimport {FILE_TYPE, checkNoOpenFileId, checkSourceFileId} from '../util/FileIdAndTypeUtils';\nimport Button from '@material-ui/core/Button';\nimport SaveIcon from '@material-ui/icons/Save';\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle';\nimport IconButton from '@material-ui/core/IconButton';\nimport SearchIcon from '@material-ui/icons/Search';\nimport {handleSaveCurrentFileEditorContent} from './Editor';\nimport {parse as parseTagFilters} from '../lib/TagFiltersGrammar';\nimport BlockTaggingEditorExtension from '../editor_extension/BlockTagging';\nimport {TagFilteringPluginKey} from '../editor_extension/plugins/TagFiltering';\nimport {Selection, TextSelection} from 'prosemirror-state';\nimport {defer} from 'lodash';\nimport FileStorageSystemClient from '../backend/FileStorageSystemClient';\nimport RemoveCircleIcon from '@material-ui/icons/RemoveCircle';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport TextField from '@material-ui/core/TextField';\nimport Grid from '@material-ui/core/Grid';\n\nconst TAG_FILTERS_INPUT_ID = 'tag_filters_input';\n\nconst DEFAULT_STATE = {\n  modifyingTagFilters: false,\n  currentTagFiltersStr: '',\n  currentParsedTagFiltersStr: '',\n  sourceSavedTagFilters: {},\n};\n\nclass Navbar extends React.Component {\n  state = DEFAULT_STATE;\n\n  handleCancelModifyingTagFilters = () => {\n    const input = document.getElementById(TAG_FILTERS_INPUT_ID);\n    input.value = this.state.currentTagFiltersStr;\n    this.setState({ modifyingTagFilters: false });\n  };\n\n  handleStartModifyingTagFilters = () => {\n    this.setState({ modifyingTagFilters: true });\n    defer(() => {\n      const input = document.getElementById(TAG_FILTERS_INPUT_ID);\n      input.focus();\n      input.setSelectionRange(input.value.length, input.value.length);\n    });\n  };\n\n  handleUnpersistCurrentTagFilters = () => {\n    if (\n      !this.state.currentTagFiltersStr ||\n      !this.state.sourceSavedTagFilters.hasOwnProperty(this.state.currentTagFiltersStr)\n    ) { return false; }\n    const newSourceSavedTagFilters = {...this.state.sourceSavedTagFilters};\n    delete newSourceSavedTagFilters[this.state.currentTagFiltersStr];\n    FileStorageSystemClient.doSetSourceSavedTagFilters(\n      this.props.currentOpenFileId.sourceId,\n      newSourceSavedTagFilters,\n    ).then(success => {\n      if (!success) { alert('failed to set source saved tag filters'); }\n      else { this.setState({ sourceSavedTagFilters: newSourceSavedTagFilters }); }\n    });\n  };\n\n  handlePersistNewSavedTagFilters = () => {\n    if (\n      !this.state.currentTagFiltersStr ||\n      this.state.sourceSavedTagFilters.hasOwnProperty(this.state.currentTagFiltersStr)\n    ) { return false; }\n    const newSourceSavedTagFilters = {...this.state.sourceSavedTagFilters};\n    newSourceSavedTagFilters[this.state.currentTagFiltersStr] = this.state.currentParsedTagFiltersStr;\n    FileStorageSystemClient.doSetSourceSavedTagFilters(\n      this.props.currentOpenFileId.sourceId,\n      newSourceSavedTagFilters,\n    ).then(success => {\n      if (!success) { alert('failed to set source saved tag filters'); }\n      else { this.setState({ sourceSavedTagFilters: newSourceSavedTagFilters }); }\n    });\n  };\n\n  handleApplyTagFilters = () => {\n    let tagFilters = null;\n    const tagFiltersStr = document.getElementById(TAG_FILTERS_INPUT_ID).value.trim();\n    if (tagFiltersStr) {\n      tagFilters = parseTagFilters(tagFiltersStr);\n      if (!tagFilters) {\n        alert('invalid tag filters');\n        return false;\n      }\n    }\n    document.getElementById(TAG_FILTERS_INPUT_ID).value = tagFiltersStr;\n    const parsedTagFiltersStr = JSON.stringify(tagFilters);\n    const oldParsedTagFiltersStr = this.state.currentParsedTagFiltersStr;\n    this.setState({ currentTagFiltersStr: tagFiltersStr, currentParsedTagFiltersStr: parsedTagFiltersStr });\n    if (parsedTagFiltersStr === oldParsedTagFiltersStr) { return true; }\n    if(BlockTaggingEditorExtension.editor !== undefined){\n      BlockTaggingEditorExtension.editor.view.dispatch(\n        BlockTaggingEditorExtension.editor.view.state.tr.setMeta(TagFilteringPluginKey, tagFilters)\n          .setSelection(\n            tagFilters\n              ? TextSelection.create(BlockTaggingEditorExtension.editor.view.state.doc, 0, 0)\n              : Selection.atStart(BlockTaggingEditorExtension.editor.view.state.doc)\n          ).scrollIntoView()\n      );\n      defer(() => {\n        if (tagFilters) { BlockTaggingEditorExtension.editor.view.dom.blur(); }\n        else { BlockTaggingEditorExtension.editor.view.focus(); }\n      });\n    }\n    return true;\n  };\n\n  changeFile = async () => {\n    if (checkSourceFileId(this.props.currentOpenFileId)) {\n        FileStorageSystemClient.doGetSourceSavedTagFilters(this.props.currentOpenFileId.sourceId)\n            .then(sourceSavedTagFilters => {\n              if (!sourceSavedTagFilters) {\n                //alert('failed to retrieve source saved tag filters');\n              } else {\n                let filters = {}\n                sourceSavedTagFilters.forEach(element => {\n                  filters[element] = element;\n                });\n                this.setState({sourceSavedTagFilters: filters});\n              }\n            });\n    }\n  };\n\n  componentDidMount = () => {\n    this.changeFile();\n  };\n\n  componentDidUpdate = prevProps => {\n    console.log(this.props.currentOpenFileId);\n    if(this.props.currentOpenFileName.viewName == '' && prevProps.currentOpenFileId.sourceId !== this.props.currentOpenFileId.sourceId){\n        document.getElementById(TAG_FILTERS_INPUT_ID).value = \"\";\n        this.handleApplyTagFilters();\n        this.setState({ sourceSavedTagFilters: {} });\n        this.changeFile();\n      }\n  };\n\n  render = () => {\n    const noOpenFileIdCheck = checkNoOpenFileId(this.props.currentOpenFileId);\n    const currentTagFiltersSaved =this.state.sourceSavedTagFilters.hasOwnProperty(this.state.currentTagFiltersStr);\n    return(\n            <AppBar position=\"static\" class=\"custom-navbar\">\n                <Toolbar>\n                    <img className={\"menuButton\"} src={require('../images/logo.png')} style={{width: \"40px\", marginRight: \"10px\"}}/>\n                    <Typography variant=\"h5\" style={{fontFamily:\"Bungee\", color:\"#F5F0E1\"}}>\n                        YADA\n                    </Typography>\n                    <div style={{flexGrow: 1, marginLeft: \"150px\"}}>\n                        {this.props.currentOpenFileName.sourceName == '' ? null : \n                        <Breadcrumbs aria-label=\"breadcrumb\" color=\"secondary\" style={{marginRight: \"10px\", float: \"left\", border:\"1px solid #F5F0E1\", borderRadius: \"10px\", padding: \"8px\"}}>\n                            <Link color=\"inherit\" style={{ color: \"#F5F0E1\",}}> \n                            <DescriptionIcon color=\"secondary\"/>\n                                {this.props.currentOpenFileName.sourceName}\n                            </Link>\n                            {this.props.currentOpenFileName.viewName == '' ? null : \n                                <Link color=\"inherit\" style={{color: \"#F5F0E1\"}}> \n                                {\n                                    (this.props.currentOpenFileId.viewType === FILE_TYPE.CARD_VIEW) ? \n                                        <AmpStoriesIcon color=\"secondary\"/>:\n                                    (this.props.currentOpenFileId.viewType === FILE_TYPE.TEXT_VIEW) ?\n                                        <TextFieldsIcon color=\"secondary\"/> :\n                                    null\n                                }\n                                {this.props.currentOpenFileName.viewName}\n                                </Link>\n                            }\n                        </Breadcrumbs>\n                        }\n                        <Button\n                        variant=\"outlined\"\n                        color=\"secondary\"\n                        title=\"save\"\n                        disabled={noOpenFileIdCheck || !this.props.saveDirtyFlag}\n                        onClick={handleSaveCurrentFileEditorContent}\n                        startIcon={<SaveIcon />}\n                        style= {{ borderRadius: \"10px\",paddingTop: \"8px\", paddingBottom: \"8px\", float: \"left\", marginRight: \"20px\" }}\n                        >\n                            Save\n                        </Button>\n                        {\n                            this.props.currentOpenFileName.viewName == '' ? \n                            <div style={{backgroundColor: \"rgba(245, 240, 225, 0.8)\", marginLeft: \"250px\", width: \"50vw\", borderRadius: \"10px\", padding: \"5px\"}}>\n                                <Grid container>\n                                  <Grid item xs={1}>\n                                    <div style={{marginTop: \"3px\", marginLeft: \"20px\"}}>\n                                        <SearchIcon color=\"primary\"/>\n                                    </div>\n                                  </Grid>\n                                  <Grid item xs={10}>\n                                  <Autocomplete\n                                    value={this.state.currentTagFiltersStr}\n                                    id={TAG_FILTERS_INPUT_ID}\n                                    freeSolo\n                                    options={Object.entries(this.state.sourceSavedTagFilters)\n                                      .map(([tagFiltersStr, _parsedTagFiltersStr]) => tagFiltersStr)}\n                                    renderInput={(params) => (\n                                      <TextField \n                                            {...params} \n                                            placeholder=\"Search with Tags: ( #{tag1} | !( #{tag2} ) ) & #{tag3}\"\n                                            style={{margin:\"0%\"}}\n                                            margin=\"normal\" \n                                            variant=\"standard\"\n                                            />\n                                    )}\n                                    onChange={(event, value, reason) => {\n                                      this.setState({currentTagFiltersStr : value});\n                                      this.handleStartModifyingTagFilters();\n                                      if (reason === 'clear'){\n                                        document.getElementById(TAG_FILTERS_INPUT_ID).value = '';\n                                        this.handleApplyTagFilters();\n                                      }\n                                    }}\n                                    onBlur={event => {\n                                      if (this.handleApplyTagFilters()) { this.setState({ modifyingTagFilters: false }); }\n                                      else {\n                                        const input = event.target;\n                                        defer(() => { input.focus(); });\n                                      }\n                                    }}\n                                    onKeyDown={event => { if (event.key === 'Escape') { this.handleCancelModifyingTagFilters(); } }}\n                                    onKeyPress={event => { if (event.key === 'Enter') { event.target.blur(); } }}\n                                  />\n                                  </Grid>\n                                  <Grid item xs={1}>\n                                <div style={{float: \"right\"}}>\n                                  { (this.state.modifyingTagFilters) ? null : \n                                      (this.state.currentTagFiltersStr == '') ? null : \n                                        (currentTagFiltersSaved) ?\n                                        <IconButton title=\"Unpersist Filter\" style={{padding: \"0px\", paddingRight: \"10px\", paddingTop: \"5px\"}}>\n                                            <RemoveCircleIcon \n                                            color=\"primary\"\n                                            onClick={() => {\n                                              document.getElementById(TAG_FILTERS_INPUT_ID).value = \"\";\n                                              this.handleUnpersistCurrentTagFilters();\n                                              this.handleApplyTagFilters();\n                                            }}\n                                            />\n                                        </IconButton> :\n                                        <IconButton title=\"Persist Filter\" style={{padding: \"0px\", paddingRight: \"10px\", paddingTop: \"5px\"}}>\n                                            <SaveIcon \n                                            color=\"primary\"\n                                            onClick={() => {\n                                              this.handlePersistNewSavedTagFilters();\n                                            }}\n                                            />\n                                        </IconButton>                                     \n                                    \n                                  }\n                                </div>      \n                                </Grid>                  \n                                </Grid>\n\n                            </div>\n                            : null\n                        }\n                    </div>\n                    <IconButton\n                    edge=\"end\"\n                    aria-label=\"account of current user\"\n                    aria-haspopup=\"true\"\n                    color=\"inherit\"\n                    style={{float: \"right\"}}\n                    >\n                    <AccountCircleIcon color=\"secondary\"/>\n                    </IconButton>\n                </Toolbar>\n            </AppBar>\n            )\n    }\n}\n\nexport default connect(\n    state => ({ currentOpenFileId: state.currentOpenFileId, currentOpenFileName: state.currentOpenFileName, backendModeSignedInStatus: state.backendModeSignedInStatus, saveDirtyFlag: state.saveDirtyFlag }),\n    dispatch => ({\n      dispatchSetBackendModeSignedInStatusAction: mode => dispatch(setBackendModeSignedInStatusAction(mode)),\n    }),\n  )(Navbar);","import React from 'react';\nimport RichMarkdownEditor from 'rich-markdown-editor';\nimport BootstrapCard from 'react-bootstrap/Card';\nimport ReactCardFlip from 'react-card-flip';\n\nclass Card extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tconsole.log(this.props.content);\n\t\tthis.state = {\n\t\t\tisFlipped: false,\n\t\t\tkey: this.props.content[\"index\"],\n\t\t\tfront: this.props.content[\"front\"],\n\t\t\tback: this.props.content[\"back\"]\n\t\t};\n\t\tthis.handleClick = this.handleClick.bind(this);\n\t\tthis.createBootstrapCard = this.createBootstrapCard.bind(this);\n\t}\n\t\n\thandleClick(e) {\n\t\te.preventDefault();\n\t\tthis.setState(prevState => ({ isFlipped: !prevState.isFlipped }));\n\t}\n\t\n\tcreateBootstrapCard(key, json) {\n\t\treturn (\n\t\t\t<BootstrapCard\n\t\t\t\tkey={key}\n\t\t\t\ttext=\"black\"\n\t\t\t\tclassName=\"BootstrapCard\"\n\t\t\t\tonClick={this.handleClick}\n\t\t\t>\n\t\t\t\t{\n\t\t\t\t\tjson &&\n\t\t\t\t\t<RichMarkdownEditor\n\t\t\t\t\t\tclassName=\"Card\"\n\t\t\t\t\t\treadOnly={true}\n\t\t\t\t\t\tkey={`card${key}`}\n\t\t\t\t\t\tdefaultValue={JSON.stringify(json)}\n\t\t\t\t\t\tjsonStrValue={true}\n\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t</BootstrapCard>\n\t\t);\n\t}\n\t\n\trender = () => {\n\t\tconst content = this.props.content;\n\t\tif (content !== undefined) {\n\t\t\tconst key = content[\"index\"];\n\t\t\tconst front = content[\"front\"];\n\t\t\tconst back = content[\"back\"];\n\t\t\treturn (\n\t\t\t\t<ReactCardFlip isFlipped={this.state.isFlipped} flipDirection=\"vertical\">\n\t\t\t\t\t{this.createBootstrapCard(key, front)}\n\t\t\t\t\t{this.createBootstrapCard(key, back)}\n\t\t\t\t</ReactCardFlip>\n\t\t\t);\n\t\t} else { return null; }\n\t};\n}\n\nexport default Card;\n","import styled from 'styled-components'\nimport React from 'react';\nimport {Droppable, Draggable} from 'react-beautiful-dnd';\n\nclass Tag extends React.Component {\n\trender = () => {\n\t\tconst Container = styled.div`\n\t\t\tborder: 1px solid lightgrey;\n\t\t\tborder-radius: 10px;\n\t\t\tpadding: 8px;\n\t\t\tmargin-bottom: 8px;\n\t\t\tbackground-color: ${props => (props.isDragging ? 'lightgreen' : 'white')};\n\t\t`;\n\t\tconst TagId = styled.h5``;\n\t\tconst Content = styled.div``\n\t\treturn (\n\t\t\t<Draggable draggableId={this.props.tagId} index={this.props.index}>\n\t\t\t\t{(provided, snapshot) => (\n\t\t\t\t\t<Container\n\t\t\t\t\t\tref={provided.innerRef}\n\t\t\t\t\t\t{...provided.draggableProps}\n\t\t\t\t\t\t{...provided.dragHandleProps}\n\t\t\t\t\t\tisDragging={snapshot.isDragging}\n\t\t\t\t\t>\n\t\t\t\t\t\t<TagId>{this.props.tagInfo[\"tag_name\"]}</TagId>\n\t\t\t\t\t\t<Content>{this.props.tagInfo.preview}</Content>\n\t\t\t\t\t</Container>\n\t\t\t\t)}\n\t\t\t</Draggable>\n\t\t);\n\t};\n}\n\nclass InnerTagList extends React.Component {\n\t// performance optimization to prevent unnecessary renders\n\tshouldComponentUpdate(nextProps, nextState, nextContext) {\n\t\treturn nextProps.tagData !== this.props.tagData;\n\t}\n\t\n\trender() {\n\t\treturn Object.keys(this.props.tagData).map((tagId, index) => (\n\t\t\t<Tag key={tagId} tagId={tagId} index={index} tagInfo={this.props.tagData[tagId]}/>\n\t\t));\n\t}\n}\n\nclass DragDropColumn extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\t// used to maintain scroll when rendering updates to tag list\n\t\tthis.tagListRef = React.createRef();\n\t}\n\t\n\tgetSnapshotBeforeUpdate(prevProps, prevState) {\n\t\tconst list = this.tagListRef.current;\n\t\treturn list.scrollHeight - list.scrollTop;\n\t}\n\t\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tif (snapshot !== null) {\n\t\t\tconst list = this.tagListRef.current;\n\t\t\tlist.scrollTop = list.scrollHeight - snapshot;\n\t\t}\n\t}\n\t\n\trender = () => {\n\t\tconst Container = styled.div`\n\t\t\tborder: 1px solid lightgrey;\n\t\t\tborder-radius: 10px;\n\t\t\tpadding: 8px;\n\t\t\tmargin-top: 10px;\n\t\t\tmargin-bottom: 10px;\n\t\t\ttransition: background-color 0.2s ease;\n\t\t\tbackground-color: ${props => (props.isDraggingOver) ? 'skyblue' : 'white'};\n\t\t`;\n\t\tconst Title = styled.h3`\n\t\t\tpadding: 8px;\n\t\t`;\n\t\tconst DroppableRegion = styled.div`\n\t\t\tpadding: 8px;\n\t\t`;\n\t\tconst TagList = styled.div`\n\t\t\toverflow-x: hidden;\n\t\t\toverflow-y: auto;\n\t\t\theight: 200px;\n\t\t\tpadding-bottom: 30px;\n\t\t`;\n\n\t\treturn (\n\t\t\t<Droppable droppableId={this.props.column.id}>\n\t\t\t\t{(provided, snapshot) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<Container isDraggingOver={snapshot.isDraggingOver}>\n\t\t\t\t\t\t\t<Title>{this.props.column.title}</Title>\n\t\t\t\t\t\t\t\t<DroppableRegion\n\t\t\t\t\t\t\t\t\tref={provided.innerRef}\n\t\t\t\t\t\t\t\t\t{...provided.droppableProps}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TagList ref={this.tagListRef}>\n\t\t\t\t\t\t\t\t\t\t<InnerTagList tagData={this.props.tagData}/>\n\t\t\t\t\t\t\t\t\t\t{provided.placeholder}\n\t\t\t\t\t\t\t\t\t</TagList>\n\t\t\t\t\t\t\t\t</DroppableRegion>\n\t\t\t\t\t\t</Container>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t</Droppable>\n\t\t);\n\t};\n}\n\nexport default DragDropColumn;\n","import React from 'react';\nimport {connect} from 'react-redux';\nimport Container from 'react-bootstrap/Container'\nimport DragDropColumn from './DragDropColumn';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport {DragDropContext} from 'react-beautiful-dnd';\nimport {setTagsInViewAction} from '../../reducers/SetTagsInView';\n\nclass TagEditor extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tconst tagsInView = new Set(this.props.tagsInView);\n\t\tconst availableTags = Object.keys(this.props.allTagsData).filter(t => !tagsInView.has(t));\n\t\t\n\t\t// parse nodes to obtain preview\n\t\tfunction getPreview(node) {\n\t\t\tfor (let i = 0; i < node.content.length; ++i) {\n\t\t\t\tconst contentNode = node.content[i];\n\t\t\t\tif (contentNode.type === \"text\") {\n\t\t\t\t\treturn contentNode.text;\n\t\t\t\t} else if (contentNode) {\n\t\t\t\t\tconst recurseResponse = getPreview(contentNode);\n\t\t\t\t\tif (recurseResponse !== \"\") return recurseResponse;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn \"\";\n\t\t}\n\t\t\n\t\tconst tagData = this.props.allTagsData;\n\t\tObject.keys(tagData).forEach(tagId => {\n\t\t\tconst preview = getPreview(tagData[tagId].content);\n\t\t\tconst maxPreviewLength = 50;\n\t\t\ttagData[tagId][\"preview\"] = preview.substring(0, maxPreviewLength);\n\t\t\tif (preview.length > maxPreviewLength) {\n\t\t\t\ttagData[tagId][\"preview\"] += \" . . .\";\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.state = {\n\t\t\ttagData: tagData,\n\t\t\tcolumns: {\n\t\t\t\ttags_in_view: {\n\t\t\t\t\tid: 'tags_in_view',\n\t\t\t\t\ttitle: \"Tags in View\",\n\t\t\t\t\ttagIds: this.props.tagsInView\n\t\t\t\t},\n\t\t\t\ttags_available: {\n\t\t\t\t\tid: 'tags_available',\n\t\t\t\t\ttitle: \"Available Tags\",\n\t\t\t\t\ttagIds: availableTags\n\t\t\t\t},\n\t\t\t},\n\t\t\tcolumnOrder: ['tags_in_view', 'tags_available']\n\t\t};\n\t}\n\t\n\tonDragEnd = result => {\n\t\tconst { destination, source, draggableId } = result;\n\t\tif (!destination) return;\n\t\tif (destination.droppableId === source.droppableId && destination.index === source.index) return;\n\t\t\n\t\tlet newState = {}\n\t\tif (destination.droppableId === source.droppableId) {\n\t\t\tconst column = this.state.columns[source.droppableId]\n\t\t\tconst newTagIds = Array.from(column.tagIds);\n\t\t\tnewTagIds.splice(source.index, 1);\n\t\t\tnewTagIds.splice(destination.index, 0, draggableId)\n\t\t\t\n\t\t\tconst newColumn = {\n\t\t\t\t...column,\n\t\t\t\ttagIds: newTagIds\n\t\t\t}\n\t\t\t\n\t\t\tnewState = {\n\t\t\t\t...this.state,\n\t\t\t\tcolumns: {\n\t\t\t\t\t...this.state.columns,\n\t\t\t\t\t[newColumn.id]: newColumn\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tconst start = this.state.columns[source.droppableId];\n\t\t\tconst finish = this.state.columns[destination.droppableId];\n\t\t\tconst startTagIds = Array.from(start.tagIds);\n\t\t\tstartTagIds.splice(source.index, 1);\n\t\t\tconst newStart = {\n\t\t\t\t...start,\n\t\t\t\ttagIds: startTagIds\n\t\t\t};\n\t\t\t\n\t\t\tconst finishTagIds = Array.from(finish.tagIds);\n\t\t\tfinishTagIds.splice(destination.index, 0, draggableId);\n\t\t\tconst newFinish = {\n\t\t\t\t...finish,\n\t\t\t\ttagIds: finishTagIds\n\t\t\t};\n\t\t\t\n\t\t\tnewState = {\n\t\t\t\t...this.state,\n\t\t\t\tcolumns: {\n\t\t\t\t\t...this.state.columns,\n\t\t\t\t\t[newStart.id]: newStart,\n\t\t\t\t\t[newFinish.id]: newFinish\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tthis.props.setTagsInView(newState.columns.tags_in_view.tagIds);\n\t\tthis.setState(newState);\n\t}\n\t\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tif (prevProps.tagsInView !== this.props.tagsInView) {\n\t\t\tconst tagsInView = new Set(this.props.tagsInView);\n\t\t\tconst availableTags = Object.keys(this.props.allTagsData).filter(t => !tagsInView.has(t));\n\t\t\tconst newState = Object.assign({}, this.state);\n\t\t\tnewState.columns.tags_in_view.tagIds = tagsInView;\n\t\t\tnewState.columns.tags_available.tagIds = availableTags;\n\t\t\tthis.setState(newState);\n\t\t}\n\t}\n\t\n\trender = () => {\n\t\treturn (\n\t\t\t<DragDropContext onDragEnd={this.onDragEnd}>\n\t\t\t\t<Container>\n\t\t\t\t\t<Row className=\"justify-content-md-center\">\n\t\t\t\t\t\t{this.state.columnOrder.map(columnId => {\n\t\t\t\t\t\t\tconst column = this.state.columns[columnId];\n\t\t\t\t\t\t\t// Generate subdict here\n\t\t\t\t\t\t\tlet tagDataInColumn = {};\n\t\t\t\t\t\t\tfor (const tagId of column.tagIds) {\n\t\t\t\t\t\t\t\ttagDataInColumn[tagId] = this.state.tagData[tagId];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Col key={column.id} md=\"12\" lg=\"6\">\n\t\t\t\t\t\t\t\t\t<DragDropColumn key={column.id} column={column} tagData={tagDataInColumn}/>\n\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})}\n\t\t\t\t\t</Row>\n\t\t\t\t</Container>\n\t\t\t</DragDropContext>\n\t\t);\n\t};\n}\n\nexport default connect(\n\tstate => ({ tagsInView: state.tagsInView }),\n\tdispatch => ({ setTagsInView: tagsInView => dispatch(setTagsInViewAction(tagsInView)) }),\n)(TagEditor);\n","import 'bootstrap/dist/css/bootstrap.min.css';\nimport './CardDeck.css';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport Card from './Card';\nimport TagEditor from '../ViewComponents/TagEditor';\nimport {setTagsInViewAction} from '../../reducers/SetTagsInView';\nimport FileStorageSystemClient from \"../../backend/FileStorageSystemClient\";\nimport {FILE_TYPE} from \"../../util/FileIdAndTypeUtils\";\n\n\nclass CardDeck extends React.Component {\n\t\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tallTagsData: props.data.allTagsData,\n\t\t}\n\t\tthis.props.setTagsInView(props.data.tagsInView);\n\t}\n\t\n\tkeydownHandler = (event) => {\n\t\tif ((window.navigator.platform.match(\"Mac\") ? event.metaKey : event.ctrlKey)  && event.keyCode === 83) {\n\t\t\tevent.preventDefault();\n\t\t\tFileStorageSystemClient.doSaveViewSpec(\n\t\t\t\tthis.props.tagsInView,\n\t\t\t\tthis.props.currentOpenFileId.sourceId,\n\t\t\t\tthis.props.currentOpenFileId.viewId,\n\t\t\t\tFILE_TYPE.CARD_VIEW,\n\t\t\t\tfalse,\n\t\t\t)\n\t\t\t\t.then(() => alert(\"Card view saved\"))\n\t\t\t\t.catch(() => alert(\"Failed to save card view\"));\n\t\t}\n\t};\n\t\n\tconstructDoc = (tagId) => {\n\t\tconst node = this.state.allTagsData[tagId][\"content\"];\n\t\treturn {\n\t\t\t\"type\": \"doc\",\n\t\t\t\"content\": [node]\n\t\t};\n\t};\n\t\n\tconstructCard = (index) => {\n\t\tconst cardContent = { \"index\": index };\n\t\tcardContent[\"front\"] = this.constructDoc(this.props.tagsInView[index]);\n\t\tif (index + 1 < this.props.tagsInView.length) {\n\t\t\tcardContent[\"back\"] = this.constructDoc(this.props.tagsInView[index+1]);\n\t\t} else { cardContent[\"back\"] = null; }\n\t\treturn <Card content={cardContent} />;\n\t};\n\t\n\tcomponentDidMount = () => {\n\t\tdocument.addEventListener('keydown',this.keydownHandler);\n\t};\n\tcomponentDidUpdate = prevProps => {\n\t\tif (prevProps.tagsInView !== this.props.tagsInView) {\n\t\t\tthis.props.setTagsInView(this.props.tagsInView);\n\t\t}\n\t};\n\tcomponentWillUnmount = () => { document.removeEventListener('keydown',this.keydownHandler); };\n\t\n\trender = () => {\n\t\tif (!this.state.allTagsData || this.props.tagsInView == null) {\n\t\t\treturn (\n\t\t\t\t<Container className=\"viewContainer\">\n\t\t\t\t\t<h5>Loading Card Deck ...</h5>\n\t\t\t\t</Container>\n\t\t\t);\n\t\t} else {\n\t\t\tconst cards = [];\n\t\t\tfor (let i = 0; i < this.props.tagsInView.length; i+=4) {\n\t\t\t\tcards.push(\n\t\t\t\t\t<Row key={`row_${i%4}`} className=\"justify-content-md-center\">\n\t\t\t\t\t\t<Col lg=\"12\" xl=\"6\">\n\t\t\t\t\t\t\t{this.constructCard(i)}\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t<Col lg=\"12\" xl=\"6\">\n\t\t\t\t\t\t\t{(i + 2 < this.props.tagsInView.length) && this.constructCard(i + 2)}\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Row>\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn (\n\t\t\t\t<Container className=\"viewContainer\">\n\t\t\t\t\t<TagEditor allTagsData={this.state.allTagsData} tagsInView={this.props.tagsInView} />\n\t\t\t\t\t{cards}\n\t\t\t\t</Container>\n\t\t\t);\n\t\t}\n\t};\n}\n\nexport default connect(\n\tstate => ({ tagsInView: state.tagsInView, currentOpenFileId: state.currentOpenFileId }),\n\tdispatch => ({ setTagsInView: tagsInView => dispatch(setTagsInViewAction(tagsInView)) }),\n)(CardDeck);\n","import 'bootstrap/dist/css/bootstrap.min.css';\nimport './TextView.css';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport Container from 'react-bootstrap/Container'\nimport TagEditor from '../ViewComponents/TagEditor';\nimport {setTagsInViewAction} from '../../reducers/SetTagsInView';\nimport FileStorageSystemClient from \"../../backend/FileStorageSystemClient\";\nimport {FILE_TYPE} from \"../../util/FileIdAndTypeUtils\";\nimport RichMarkdownEditor from \"rich-markdown-editor\";\n\n\nclass TextView extends React.Component {\n\t\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tallTagsData: props.data.allTagsData,\n\t\t}\n\t\tthis.props.setTagsInView(props.data.tagsInView);\n\t}\n\t\n\tkeydownHandler = (event) => {\n\t\tif ((window.navigator.platform.match(\"Mac\") ? event.metaKey : event.ctrlKey)  && event.keyCode === 83) {\n\t\t\tevent.preventDefault();\n\t\t\tFileStorageSystemClient.doSaveViewSpec(\n\t\t\t\tthis.props.tagsInView,\n\t\t\t\tthis.props.currentOpenFileId.sourceId,\n\t\t\t\tthis.props.currentOpenFileId.viewId,\n\t\t\t\tFILE_TYPE.TEXT_VIEW,\n\t\t\t\tfalse,\n\t\t\t\t)\n\t\t\t\t.then(() => alert(\"Text view saved\"))\n\t\t\t\t.catch(() => alert(\"Failed to save text view\"));\n\t\t}\n\t};\n\t\n\tconstructTextView = () => {\n\t\treturn {\n\t\t\t\"type\": \"doc\",\n\t\t\t\"content\": this.props.tagsInView.map(t => this.state.allTagsData[t][\"content\"])\n\t\t};\n\t};\n\t\n\tcomponentDidMount = () => {\n\t\tdocument.addEventListener('keydown',this.keydownHandler);\n\t};\n\tcomponentDidUpdate = prevProps => {\n\t\tif (prevProps.tagsInView !== this.props.tagsInView) {\n\t\t\tthis.props.setTagsInView(this.props.tagsInView);\n\t\t}\n\t};\n\tcomponentWillUnmount = () => { document.removeEventListener('keydown',this.keydownHandler); };\n\t\n\trender = () => {\n\t\tif (!this.state.allTagsData || this.props.tagsInView == null) {\n\t\t\treturn (\n\t\t\t\t<Container className=\"viewContainer\">\n\t\t\t\t\t<h5>Loading Text View ...</h5>\n\t\t\t\t</Container>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<Container className=\"viewContainer\">\n\t\t\t\t\t<TagEditor allTagsData={this.state.allTagsData} tagsInView={this.props.tagsInView} />\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.props.tagsInView.length > 0 &&\n\t\t\t\t\t\t<RichMarkdownEditor\n\t\t\t\t\t\t\tclassName=\"TextViewEditor\"\n\t\t\t\t\t\t\treadOnly={true}\n\t\t\t\t\t\t\tkey={\"text_view\"}\n\t\t\t\t\t\t\tdefaultValue={JSON.stringify(this.constructTextView())}\n\t\t\t\t\t\t\tjsonStrValue={true}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</Container>\n\t\t\t);\n\t\t}\n\t};\n}\n\nexport default connect(\n\tstate => ({ tagsInView: state.tagsInView, currentOpenFileId: state.currentOpenFileId }),\n\tdispatch => ({ setTagsInView: tagsInView => dispatch(setTagsInViewAction(tagsInView)) }),\n)(TextView);\n","import './ViewEditor.css';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {\n\tFILE_TYPE,\n\tNO_OPEN_FILE_ID\n} from \"../util/FileIdAndTypeUtils\";\nimport FileStorageSystemClient from \"../backend/FileStorageSystemClient\";\nimport {handleSetCurrentOpenFileId} from \"./Navigator\";\nimport CardDeck from \"./CardView/CardDeck\";\nimport TextView from \"./TextView/TextView\";\n\nconst DEFAULT_STATE = {\n\tsourceId: 0,\n\tviewId: 0,\n\tdata: null,\n\tfileType: FILE_TYPE.EMPTY\n};\n\nclass ViewEditor extends React.Component {\n\t\n\tstate = DEFAULT_STATE;\n\t\n\tchangeFile = async () => {\n\t\tFileStorageSystemClient.doGetView(this.props.currentOpenFileId).then(value => {\n\t\t\tif (value === null) {\n\t\t\t\talert('failed to retrieve view');\n\t\t\t\thandleSetCurrentOpenFileId(NO_OPEN_FILE_ID);\n\t\t\t} else {\n\t\t\t\tthis.setState({\n\t\t\t\t\tsourceId: this.props.currentOpenFileId.sourceId,\n\t\t\t\t\tviewId: this.props.currentOpenFileId.viewId,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttagsInView: value[\"view\"][\"order\"],\n\t\t\t\t\t\tallTagsData: value[\"tags\"][\"items\"]\n\t\t\t\t\t},\n\t\t\t\t\tfileType: this.props.currentOpenFileId.viewType\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t\n\tcomponentDidMount = () => {\n\t\tthis.changeFile().then(() => console.log(\"Mounted view file\"));\n\t};\n\tcomponentDidUpdate = prevProps => {\n\t\tif (\n\t\t\tprevProps.currentOpenFileId.sourceId !== this.props.currentOpenFileId.sourceId ||\n\t\t\tprevProps.currentOpenFileId.viewId !== this.props.currentOpenFileId.viewId\n\t\t) {\n\t\t\tthis.changeFile().then(() => console.log(\"Updated view file\"));\n\t\t}\n\t};\n\t\n\trender = () => {\n\t\tif (this.state.fileType === FILE_TYPE.CARD_VIEW) {\n\t\t\treturn <CardDeck data={this.state.data}/>;\n\t\t} else if (this.state.fileType === FILE_TYPE.TEXT_VIEW) {\n\t\t\treturn <TextView data={this.state.data}/>;\n\t\t}\n\t\treturn null;\n\t};\n}\n\nexport default connect(state => ({ currentOpenFileId: state.currentOpenFileId }))(ViewEditor);\n\n","import './Editor.css';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport SourceEditorWithTagFilters from \"./SourceEditorWithTagFiltersInput\";\nimport {\n\tcheckSourceFileId,\n\tcheckViewFileId,\n\tFILE_TYPE,\n} from \"../util/FileIdAndTypeUtils\";\nimport ViewEditor from \"./ViewEditor\";\nimport Container from \"react-bootstrap/Container\";\n\nconst DEFAULT_STATE = {\n\tfileType: FILE_TYPE.EMPTY,\n};\n\nclass EditorManager extends React.Component {\n\t\n\tstate = DEFAULT_STATE;\n\t\n\tchangeFile = () => {\n\t\tif (checkSourceFileId(this.props.currentOpenFileId)) {\n\t\t\tthis.setState({fileType: FILE_TYPE.SOURCE});\n\t\t} else if (checkViewFileId(this.props.currentOpenFileId)) {\n\t\t\tthis.setState({fileType: FILE_TYPE.CARD_VIEW});\n\t\t} else {\n\t\t\tthis.setState({fileType: FILE_TYPE.EMPTY});\n\t\t}\n\t};\n\t\n\t\n\tcomponentDidMount = () => {\n\t\tthis.changeFile();\n\t};\n\t\n\tcomponentDidUpdate = prevProps => {\n\t\tif (\n\t\t\tprevProps.currentOpenFileId.sourceId !== this.props.currentOpenFileId.sourceId ||\n\t\t\tprevProps.currentOpenFileId.viewId !== this.props.currentOpenFileId.viewId\n\t\t) {\n\t\t\tthis.changeFile();\n\t\t}\n\t};\n\t\n\trender = () => {\n\t\tif (this.state.fileType === FILE_TYPE.EMPTY) {\n\t\t\treturn (\n\t\t\t\t<Container className=\"viewContainer\">\n\t\t\t\t\t<h5>Click/create a document!</h5>\n\t\t\t\t</Container>\n\t\t\t);\n\t\t}\n\t\tif (this.state.fileType === FILE_TYPE.SOURCE) {\n\t\t\treturn <SourceEditorWithTagFilters />;\n\t\t}\n\t\treturn <ViewEditor/>;\n\t};\n};\n\nexport default connect(state => ({ currentOpenFileId: state.currentOpenFileId, currentOpenFileName: state.currentOpenFileName }))(EditorManager);\n","import './App.css';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {checkSourceFileId} from './util/FileIdAndTypeUtils';\nimport {\n  BACKEND_MODE_SIGNED_IN_STATUS,\n  getUserSignedInStatus,\n  setBackendModeSignedInStatusAction,\n} from './reducers/BackendModeSignedInStatus';\nimport LandingPage from './components/LandingPage';\nimport Navigator from './components/Navigator';\nimport Navbar from './components/Navbar';\nimport {handleSaveCurrentFileEditorContent} from './components/Editor';\nimport EditorManager from \"./components/EditorManager\";\nimport \"./components/LandingPage.css\"\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles';\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: {\n      main: '#1E3D59'\n    },\n    secondary: {\n      main: '#F5F0E1'\n    }\n  }\n});\n\nclass App extends React.Component {\n\n  state = { mounted: false };\n\n  keydownHandler = event => {\n    if ((window.navigator.platform.match(\"Mac\") ? event.metaKey : event.ctrlKey) && event.keyCode === 83) {\n      event.preventDefault();\n      if (this.props.backendModeSignedInStatus !== BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_OUT) {\n        if (checkSourceFileId(this.props.currentOpenFileId)) { handleSaveCurrentFileEditorContent(); }\n      }\n    }\n  }\n\n  componentWillUnmount = () => { document.removeEventListener('keydown', this.keydownHandler); };\n\n  componentDidMount = () => {\n    document.addEventListener('keydown',this.keydownHandler);\n    if (this.props.backendModeSignedInStatus !== BACKEND_MODE_SIGNED_IN_STATUS.LOCAL_STORAGE) {\n      getUserSignedInStatus().then(backendModeSignedInStatus => {\n        this.props.dispatchSetBackendModeSignedInStatusAction(backendModeSignedInStatus);\n        this.setState({ mounted: true });\n      });\n    } else { this.setState({ mounted: true }); }\n  };\n  \n  render = () =>\n    <MuiThemeProvider theme={theme}>\n    <React.Fragment>\n      {\n        this.state.mounted\n          ? (\n              this.props.backendModeSignedInStatus !== BACKEND_MODE_SIGNED_IN_STATUS.USER_SIGNED_OUT\n                ? <div className=\"App\">\n                    <div style={{flex: \"0 1 auto\"}}>\n                      <Navbar />\n                    </div>\n                    {/* <div style={{ position: 'absolute', top: '9px', right: '16px', fontSize: '.75em' }}>\n                      <span role=\"img\" aria-label=\"Yet Another Docs App\">\n                        🐇 &nbsp; <b>Y</b>et <b>A</b>nother <b>D</b>ocs <b>A</b>pp\n                      </span>\n                    </div> */}\n                      <div style={{flex: \"1 1 auto\"}}>\n                        <div style={{float: \"left\", height: \"100%\"}}>\n                            <Navigator />\n                        </div>\n                        <div style={{height: \"100%\"}}>\n                            <EditorManager/>\n                        </div>\n                      </div>\n                    </div>\n                : <LandingPage />\n            )\n          : null\n      }\n      {/* <div className=\"NoApp\">\n        This app doesn't support mobile screen widths.\n      </div> */}\n    </React.Fragment>\n    </MuiThemeProvider>\n};\n\nexport default connect(\n  state => ({\n    backendModeSignedInStatus: state.backendModeSignedInStatus,\n    currentOpenFileId: state.currentOpenFileId,\n    currentOpenFileName: state.currentOpenFileName\n  }),\n  dispatch => ({\n    dispatchSetBackendModeSignedInStatusAction: mode => dispatch(setBackendModeSignedInStatusAction(mode)),\n  }),\n)(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n  )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: {'Service-Worker': 'script'},\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport {render} from 'react-dom';\nimport {Provider} from 'react-redux';\nimport './index.css';\nimport App from './App';\nimport store from './store';\nimport * as serviceWorker from './serviceWorker';\n\nrender(\n  <React.StrictMode>\n    <link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap\" />\n    <link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" />\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" />\n    <link href=\"https://fonts.googleapis.com/css2?family=Bungee&display=swap\" rel=\"stylesheet\" /> \n    <link href=\"https://fonts.googleapis.com/css2?family=Signika:wght@300&display=swap\" rel=\"stylesheet\"></link>\n    <Provider store={store}>\n      <App/>\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}